/*! moxtra-latest 2021-12-29 */

!function(e){("object"!=typeof exports||"undefined"==typeof module)&&"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function e(t){var r=this.constructor;return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){return r.reject(e)})})}function r(){}function n(e){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function a(r,o){for(;3===r._state;)r=r._value;0!==r._state?(r._handled=!0,n._immediateFn(function(){var e,t=1===r._state?o.onFulfilled:o.onRejected;if(null!==t){try{e=t(r._value)}catch(e){return void s(o.promise,e)}i(o.promise,e)}else(1===r._state?i:s)(o.promise,r._value)})):r._deferreds.push(o)}function i(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof n)return t._state=3,t._value=e,void d(t);if("function"==typeof r)return void c((o=r,a=e,function(){o.apply(a,arguments)}),t)}t._state=1,t._value=e,d(t)}catch(e){s(t,e)}var o,a}function s(e,t){e._state=2,e._value=t,d(e)}function d(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)a(e,e._deferreds[t]);e._deferreds=null}function c(e,t){var r=!1;try{e(function(e){r||(r=!0,i(t,e))},function(e){r||(r=!0,s(t,e))})}catch(e){if(r)return;r=!0,s(t,e)}}var t=setTimeout;n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(o,e){var t=new this.constructor(r);return a(this,new function(e,t,r){this.onFulfilled="function"==typeof o?o:null,this.onRejected="function"==typeof t?t:null,this.promise=r}(0,e,t)),t},n.prototype.finally=e,n.all=function(t){return new n(function(a,n){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var i=Array.prototype.slice.call(t);if(0===i.length)return a([]);for(var s=i.length,e=0;i.length>e;e++)!function t(r,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var o=e.then;if("function"==typeof o)return o.call(e,function(e){t(r,e)},n),0}i[r]=e,0==--s&&a(i)}catch(e){n(e)}}(e,i[e])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(e){e(t)})},n.reject=function(r){return new n(function(e,t){t(r)})},n.race=function(a){return new n(function(e,t){for(var r=0,o=a.length;r<o;r++)a[r].then(e,t)})},n._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){t(e,0)},n._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var o=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in o?o.Promise.prototype.finally||(o.Promise.prototype.finally=e):o.Promise=n}),function(e,t){"use strict";"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.MIPC=e.MIPC||{})}(this,function(e){"use strict";function t(e,i){var s={},d={},c={},l=[];function a(e,t,r){e.postMessage(JSON.stringify(t),r||"*")}function n(e){var t;e.timeoutid=(t=e.id,setTimeout(function(){var e=s[t];e&&e.reject&&e.reject("The relevant process did not respond in 30 seconds.")},3e4)),s[e.id]=e}function m(e,t,r,o){return{action:"ipcMessage",error:o,type:e,params:t,id:r||+Date.now()+100*Math.random()+Math.random()}}function _(e,t,r,o){o=m(t.method,r,t.id,o);o.isReplay=!0,a(e,o)}function t(e){var t,r,o,a,n;if(e.data){try{t=JSON.parse(e.data)}catch(e){}t&&"ipcMessage"===t.action&&(t.isReplay?(t=s[(e=t).id])&&(e.error?t.reject(e.error):t.resolve(e.params),t.timeoutid&&clearTimeout(t.timeoutid),t.reject=t.resolve=null,delete s[t.id]):t.isValue?(c[t.type]!==t.params&&(c[t.type]=t.params),(n=l[(a=t).type])&&n.forEach(function(e){e.fn.call(e.scope,c[a.type])})):(n=d[t.type])?n.apply({},t.params).then(function(e){_(i,t,e)},(r=i,o=t,function(e){_(r,o,null,e.message)})):console.error("Not define the IPC call ["+t.type+"]"))}}return e.addEventListener("message",t),{call:function(e,t){return r=i,o=m(e,t),a(r,o),new Promise(function(e,t){o.resolve=e,o.reject=t,n(o)});var r,o},registerAsyncCall:function(e,t){d[e]=t},registerCall:function(e,r,o){this.registerAsyncCall(e,function(){var t=[].slice.call(arguments);return new Promise(function(e){e(r.apply(o||null,t))})})},listen:function(e,t,r){l[e]||(l[e]=[]);var o=(e=e.split("."))[1];if(!t){if(o){for(var a=l[e],n=0;n<a.length;n++)if(a[n].suffix===o){a.splice(n,1);break}if(a.length)return}l[e]=null,delete l[e]}l[e].push({suffix:o,fn:t,scope:r})},stopListen:function(e){this.listen(e,null)},get:function(t){return new Promise(function(e){e(c[t])})},set:function(e,t){var r;r=i,(t=m(e,t=t)).isValue=!0,a(r,t)},destroy:function(){e.removeEventListener("message",t),Object.keys(d).forEach(function(e){delete d[e]}),d=null,Object.keys(l).forEach(function(e){delete l[e]}),l=null,Object.keys(s).forEach(function(e){var t=s[e];t&&(t.reject=t.resolve=null,delete s[e])}),c=null}}}e.create=t});var Moxtra_CryptoJS=Moxtra_CryptoJS||function(s){var e={},t=e.lib={},r=t.Base={extend:function(e){l.prototype=this;var t=new l;return e&&t.mixIn(e),t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}},d=t.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,r=e.words,o=this.sigBytes,e=e.sigBytes;if(this.clamp(),o%4)for(var a=0;a<e;a++)t[o+a>>>2]|=(r[a>>>2]>>>24-a%4*8&255)<<24-(o+a)%4*8;else if(65535<r.length)for(a=0;a<e;a+=4)t[o+a>>>2]=r[a>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=s.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(4294967296*s.random()|0);return d.create(t,e)}}),o=e.enc={},a=o.Hex={stringify:function(e){for(var t=e.words,e=e.sigBytes,r=[],o=0;o<e;o++){var a=t[o>>>2]>>>24-o%4*8&255;r.push((a>>>4).toString(16)),r.push((15&a).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o+=2)r[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return d.create(r,t/2)}},n=o.Latin1={stringify:function(e){for(var t=e.words,e=e.sigBytes,r=[],o=0;o<e;o++)r.push(String.fromCharCode(t[o>>>2]>>>24-o%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o++)r[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return d.create(r,t)}},i=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(n.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return n.parse(unescape(encodeURIComponent(e)))}},c=t.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=d.create(),this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=i.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,o=t.sigBytes,a=this.blockSize,n=o/(4*a),e=(n=e?s.ceil(n):s.max((0|n)-this._minBufferSize,0))*a,o=s.min(4*e,o);if(e){for(var i=0;i<e;i+=a)this._doProcessBlock(r,i);i=r.splice(0,e),t.sigBytes-=o}return d.create(i,o)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});function l(){}t.Hasher=c.extend({init:function(){this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize(),this._hash},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:16,_createHelper:function(r){return function(e,t){return r.create(t).finalize(e)}},_createHmacHelper:function(r){return function(e,t){return m.HMAC.create(r,t).finalize(e)}}});var m=e.algo={};return e}(Math);!function(o){var e=Moxtra_CryptoJS,t=(r=e.lib).WordArray,r=r.Hasher,a=e.algo,n=[],f=[];!function(){function e(e){return 4294967296*(e-(0|e))|0}for(var t=2,r=0;r<64;)!function(e){for(var t=o.sqrt(e),r=2;r<=t;r++)if(!(e%r))return;return 1}(t)||(r<8&&(n[r]=e(o.pow(t,.5))),f[r]=e(o.pow(t,1/3)),r++),t++}();var u=[],a=a.SHA256=r.extend({_doReset:function(){this._hash=t.create(n.slice(0))},_doProcessBlock:function(e,t){for(var r,o,a=this._hash.words,n=a[0],i=a[1],s=a[2],d=a[3],c=a[4],l=a[5],m=a[6],_=a[7],p=0;p<64;p++)p<16?u[p]=0|e[t+p]:(r=u[p-15],o=u[p-2],u[p]=((r<<25|r>>>7)^(r<<14|r>>>18)^r>>>3)+u[p-7]+((o<<15|o>>>17)^(o<<13|o>>>19)^o>>>10)+u[p-16]),r=_+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&l^~c&m)+f[p]+u[p],o=((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+(n&i^n&s^i&s),_=m,m=l,l=c,c=d+r|0,d=s,s=i,i=n,n=r+o|0;a[0]=a[0]+n|0,a[1]=a[1]+i|0,a[2]=a[2]+s|0,a[3]=a[3]+d|0,a[4]=a[4]+c|0,a[5]=a[5]+l|0,a[6]=a[6]+m|0,a[7]=a[7]+_|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;t[o>>>5]|=128<<24-o%32,t[15+(64+o>>>9<<4)]=r,e.sigBytes=4*t.length,this._process()}});e.SHA256=r._createHelper(a),e.HmacSHA256=r._createHmacHelper(a)}(Math),function(){var e=Moxtra_CryptoJS,s=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,t){e=this._hasher=e.create(),"string"==typeof t&&(t=s.parse(t));var r=e.blockSize,o=4*r;t.sigBytes>o&&(t=e.finalize(t));for(var e=this._oKey=t.clone(),t=this._iKey=t.clone(),a=e.words,n=t.words,i=0;i<r;i++)a[i]^=1549556828,n[i]^=909522486;e.sigBytes=t.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,e=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=Moxtra_CryptoJS,d=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,o=this._map;e.clamp();for(var e=[],a=0;a<r;a+=3)for(var n=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,i=0;i<4&&a+.75*i<r;i++)e.push(o.charAt(n>>>6*(3-i)&63));if(t=o.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=(e=e.replace(/\s/g,"")).length,r=this._map;!(n=r.charAt(64))||-1!=(n=e.indexOf(n))&&(t=n);for(var o,a,n=[],i=0,s=0;s<t;s++)s%4&&(o=r.indexOf(e.charAt(s-1))<<s%4*2,a=r.indexOf(e.charAt(s))>>>6-s%4*2,n[i>>>2]|=(o|a)<<24-i%4*8,i++);return d.create(n,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),"undefined"==typeof JSON&&moxo_loadScript("json.js",null);var JSONfn=JSONfn||{};JSONfn.stringify=function(e){return JSON.stringify(e,function(e,t){if("function"!=typeof t)return t;t=t.toString();return-1!=t.indexOf("[native code]")?"":t})},JSONfn.parse=function(str){return JSON.parse(str,function(key,value){return"string"!=typeof value?value:"function"==value.substring(0,8)?eval("("+value+")"):value})};var Moxtra_Session=Moxtra_Session||{};Moxtra_Session.set=function(e,t){window.sessionStorage&&(t=JSONfn.stringify(t),sessionStorage.setItem(e,t))},Moxtra_Session.get=function(e){if(window.sessionStorage){e=sessionStorage.getItem(e);return e?JSONfn.parse(e):null}},Moxtra_Session.remove=function(e){window.sessionStorage&&sessionStorage.removeItem(e)},Moxtra_Session.clear=function(){window.sessionStorage&&sessionStorage.clear()};var Moxtra=Moxtra||{};Moxtra._generateDomain=function(e,t,r){return"dev"===t?t="grouphour":"prod"===t&&(t="moxtra"),r=r||"com","//:sptth".split("").reverse().join("")+[e,t,r].join(".")},Moxtra.baseUrl=Moxtra._generateDomain("www","prod"),Moxtra.ssoUrl=Moxtra.baseUrl+"/sp/startSSO",Moxtra.version="/service";var htmlEvents={onload:1,onunload:1,onblur:1,onchange:1,onfocus:1,onreset:1,onselect:1,onsubmit:1,onabort:1,onkeydown:1,onkeypress:1,onkeyup:1,onclick:1,ondblclick:1,onmousedown:1,onmousemove:1,onmouseout:1,onmouseover:1,onmouseup:1};function eventFire(e,t){var r;e.fireEvent?e.fireEvent("on"+t):((r=document.createEvent("Event")).initEvent(t,!1,!1),e.dispatchEvent(r))}function moxo_triggerEvent(e,t){var r;document.createEvent?(r=document.createEvent("Event")).initEvent(t,!1,!1):document.createEventObject&&((r=document.createEventObject()).eventType=t),r.eventName=t,e.dispatchEvent?e.dispatchEvent(r):e.fireEvent&&htmlEvents["on"+t]?e.fireEvent("on"+r.eventType,r):e[t]?e[t]():e["on"+t]&&e["on"+t]()}function moxo_install(e){for(var t=e.target;void 0===t.href;)t=t.parentNode;e={Moxo:{URL:e.target.href,toString:function(){return this.URL}}};return InstallTrigger.install(e),!1}function moxo_downloadURI(e,t){e=Moxtra._createHiddenIframe(e);document.body.appendChild(e)}function moxo_loadScript(e,t){var r=document.createElement("script");r.type="text/javascript",r.readyState?r.onreadystatechange=function(){"loaded"!=r.readyState&&"complete"!=r.readyState||(r.onreadystatechange=null,t&&"function"==typeof t&&t())}:r.onload=function(){t&&"function"==typeof t&&t()},r.src=e,document.getElementsByTagName("head")[0].appendChild(r)}function compareOrigin(e){return-1<Moxtra.baseUrl.indexOf(e)}Moxtra._viewMap={},Moxtra._handlerMap={},Moxtra._invalidTokenSessionMap={},Moxtra._timeMap={},Moxtra._auth2faMap={},Moxtra.addListener=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&htmlEvents["on"+t]?e.attachEvent("on"+t,r):e["on"+t]=r},Moxtra.removeListener=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&htmlEvents["on"+t]?e.detachEvent("on"+t,r):e["on"+t]=null,console.log("remove handler: "+r)},Moxtra.isIE=function(){if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent.toLowerCase();if(-1!=e.indexOf("msie"))if(parseInt(e.split("msie")[1])<10)return!0}return!1},Moxtra._JOINUrl=function(e){return e.joinURL},Moxtra._SSOUrl=function(e,t){var r="websdk";e&&e.type&&(r=e.type);var o,a=encodeURIComponent(window.location.protocol+"//"+window.location.host),n=!1;if(1==t){if(s=e&&e.email?(s=e&&e.refresh_binder_id?Moxtra.baseUrl+Moxtra.version+"/#meet/"+e.refresh_binder_id+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a:Moxtra.baseUrl+Moxtra.version+"/#api.startMeet?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a)+"&email="+encodeURIComponent(e.email):e&&e.unique_id?(s=e&&e.refresh_binder_id?Moxtra.baseUrl+Moxtra.version+"/#meet/"+e.refresh_binder_id+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a:Moxtra.baseUrl+Moxtra.version+"/#api.startMeet?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a)+"&unique_id="+encodeURIComponent(e.unique_id):e&&e.refresh_binder_id?Moxtra.baseUrl+Moxtra.version+"/#meet/"+e.refresh_binder_id+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a:Moxtra.baseUrl+Moxtra.version+"/#api.startMeet?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.schedule_binder_id?s=s+"&schedule_binder_id="+e.schedule_binder_id:e&&e.binder_id&&(s=s+"&binder_id="+e.binder_id),e&&e.invite_members&&(s=s+"&invite_members="+e.invite_members),e&&e.produce_feeds&&(s=s+"&produce_feeds="+e.produce_feeds),e&&e.video&&(s+="&video=true"),e&&e.topic&&(s=s+"&topic="+e.topic),e&&e.options)try{var i=JSON.stringify(e.options),s=s+"&options="+encodeURIComponent(i)}catch(e){console.warn(e.message)}if(e&&e.tags)try{var d=JSON.stringify(e.tags);s=s+"&tags="+encodeURIComponent(d)}catch(e){console.warn(e.message)}}else if(2==t)s=e&&e.noterefresh_binder_id?Moxtra.baseUrl+Moxtra.version+"/#note/"+e.noterefresh_binder_id+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a:Moxtra.baseUrl+Moxtra.version+"/#api.startNote?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.binder_id&&(s=s+"&binder_id="+e.binder_id),e&&e.page_index&&(s=s+"&page_index="+e.page_index);else if(3==t)e&&e.binder_id?(s=Moxtra.baseUrl+Moxtra.version+"/#api.chat/"+e.binder_id,e.file_id&&(s=s+"/"+e.file_id)):s=Moxtra.baseUrl+Moxtra.version+"/#api.startChat",s=s+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.binder_id&&(e.chat_id?(s=s+"&seq="+e.chat_id+"&tab=tab_chat",n=!0):e.page_id?(s=s+"&seq="+e.page_id+"&tab=tab_pages",n=!0):e.todo_id?(s=s+"&seq="+e.todo_id+"&tab=tab_todo",n=!0):e.file_id&&(s+="&tab=tab_pages",n=!0)),e&&e.invite_members&&(s=s+"&invite_members="+e.invite_members),e&&e.produce_feeds&&(s=s+"&produce_feeds="+e.produce_feeds),e&&e.email?s=s+"&email="+encodeURIComponent(e.email):e&&e.unique_id&&(s=s+"&unique_id="+encodeURIComponent(e.unique_id)),e&&e.binder_name&&(s=s+"&binder_name="+encodeURIComponent(e.binder_name)),!n&&e&&e.tab&&(s=s+"&tab="+e.tab);else if(4==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.timeline?header=0&client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.binder_id&&(s=s+"&binder_id="+e.binder_id);else if(5==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.timeline",e&&e.binder_id&&(s=s+"/"+e.binder_id,e.file_id&&(s=s+"/"+e.file_id)),s=s+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.binder_id&&(e.chat_id?(s=s+"&seq="+e.chat_id+"&tab=tab_chat",n=!0):e.page_id?(s=s+"&seq="+e.page_id+"&tab=tab_pages",n=!0):e.todo_id?(s=s+"&seq="+e.todo_id+"&tab=tab_todo",n=!0):e.file_id&&(s+="&tab=tab_pages",n=!0)),e&&e.invite_members&&(s=s+"&invite_members="+e.invite_members),e&&e.filter&&(s=s+"&filter="+e.filter,"category"==e.filter&&e.filter_value&&(s=s+"&filter_value="+e.filter_value)),e&&e.produce_feeds&&(s=s+"&produce_feeds="+e.produce_feeds),!n&&e&&e.tab&&(s=s+"&tab="+e.tab);else if(6==t)s=(s=e&&e.binder_id?Moxtra.baseUrl+Moxtra.version+"/#api.annotate/"+e.binder_id:Moxtra.baseUrl+Moxtra.version+"/#api.startAnnotate")+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.binder_name&&(s=s+"&binder_name="+encodeURIComponent(e.binder_name));else if(7==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.endMeet/"+e.session_key+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a;else if(8==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.video?video=true&client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.videorefresh_session_key?s=s+"&session_key="+e.videorefresh_session_key:e&&e.session_key&&(s=s+"&session_key="+e.session_key,e&&e.invisible&&(s=s+"&invisible="+e.invisible),e&&e.user_name&&(s=s+"&name="+encodeURIComponent(e.user_name))),e&&e.layout_mode&&(s=s+"&mode="+e.layout_mode);else if(9==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.ui.timeline",s=(s=e&&e.binder_id?s+"/"+e.binder_id:s)+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.filter&&(s=s+"&filter="+e.filter,"category"==e.filter&&e.filter_value&&(s=s+"&filter_value="+e.filter_value)),e&&e.category&&(s=s+"&category="+e.category);else if(10==t)s=Moxtra.baseUrl,e&&e.binder_id?(s=s+Moxtra.version+"/#api.ui.binder/"+e.binder_id+"?",e.chat_id&&(s=s+"seq="+e.chat_id+"&")):s=s+Moxtra.version+"/#api.startChat?view=ui.binder&",e&&e.email?s=s+"email="+encodeURIComponent(e.email)+"&":e&&e.unique_id&&(s=s+"unique_id="+encodeURIComponent(e.unique_id)+"&"),s=(s=e&&e.transaction_id?s+"&transaction_id="+e.transaction_id:s)+"client_id="+Moxtra.clientId+"&type="+r+"&origin="+a+"&tab=tab_chat";else if(11==t){if(e&&e.viewlink_url)return e.viewlink_url+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a+"&tab=tab_pages";s=Moxtra.baseUrl+Moxtra.version+"/#api.ui.binder",e&&e.binder_id?(s=s+"/"+e.binder_id+"?",e.page_id&&(s=s+"seq="+e.page_id+"&"),e.transaction_id&&(s=s+"&transaction_id="+e.transaction_id+"&"),e&&e.transaction_file_id&&(s=s+"&transaction_file_id="+e.transaction_file_id+"&"),e&&e.transaction_files&&(s=s+"&transaction_files="+decodeURIComponent(JSON.stringify(e.transaction_files))+"&")):s+="?",s=s+"client_id="+Moxtra.clientId+"&type="+r+"&origin="+a+"&tab=tab_pages"}else if(12==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.ui.binder",e&&e.binder_id?(s=s+"/"+e.binder_id+"?",e.todo_id&&(s=s+"seq="+e.todo_id+"&")):s+="?",s=s+"client_id="+Moxtra.clientId+"&type="+r+"&origin="+a+"&tab=tab_todo";else if(13==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.data.timeline",s=(s=e&&e.binder_id?s+"/"+e.binder_id:s)+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a;else if(14==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.ui.binder",s=(s=e&&e.binder_id?s+"/"+e.binder_id:s)+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a+"&tab=tab_meet",e&&e.invite_members&&(s=s+"&invite_members="+e.invite_members),e&&e.produce_feeds&&(s=s+"&produce_feeds="+e.produce_feeds);else if(15==t)s=(s=Moxtra.baseUrl+Moxtra.version+"/#api.meet.prepare")+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.module&&(s=s+"&module="+e.module),e&&e.role&&(s=s+"&role="+e.role);else if(16==t)s=(s=Moxtra.baseUrl+Moxtra.version+"/#api.meet.ds")+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.action&&(s=s+"&action="+e.action),e&&e.session_key&&(s=s+"&session_key="+e.session_key);else if(17==t)s=Moxtra.baseUrl+Moxtra.version+"/#api.ui.audit/"+e.binder_id,s=(s=e&&e.file_id?s+"/"+e.file_id:s)+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.feed_id&&(s=s+"&seq="+e.feed_id),e&&e.transaction_id&&(s=s+"&transaction_id="+e.transaction_id);else if(18==t){if(s=e&&e.email?(s=e&&e.refresh_binder_id?Moxtra.baseUrl+Moxtra.version+"/#meet/"+e.refresh_binder_id+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a:Moxtra.baseUrl+Moxtra.version+"/#api.startCB?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a)+"&email="+encodeURIComponent(e.email):e&&e.unique_id?(s=e&&e.refresh_binder_id?Moxtra.baseUrl+Moxtra.version+"/#meet/"+e.refresh_binder_id+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a:Moxtra.baseUrl+Moxtra.version+"/#api.startCB?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a)+"&unique_id="+encodeURIComponent(e.unique_id):e&&e.refresh_binder_id?Moxtra.baseUrl+Moxtra.version+"/#meet/"+e.refresh_binder_id+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a:Moxtra.baseUrl+Moxtra.version+"/#api.startCB?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.schedule_binder_id?s=s+"&schedule_binder_id="+e.schedule_binder_id:e&&e.binder_id&&(s=s+"&binder_id="+e.binder_id),e&&e.invite_members&&(s=s+"&invite_members="+e.invite_members),e&&e.produce_feeds&&(s=s+"&produce_feeds="+e.produce_feeds),e&&e.video&&(s+="&video=true"),e&&e.topic&&(s=s+"&topic="+e.topic),e&&e.options)try{i=JSON.stringify(e.options);s=s+"&options="+encodeURIComponent(i)}catch(e){console.warn(e.message)}if(e&&e.tags)try{d=JSON.stringify(e.tags);s=s+"&tags="+encodeURIComponent(d)}catch(e){console.warn(e.message)}}else 19==t&&(s=(s=Moxtra.baseUrl+Moxtra.version+"/#api.transaction/"+e.binder_id)+"?client_id="+Moxtra.clientId+"&type="+r+"&origin="+a,e&&e.transaction_id&&(s=s+"&seq="+e.transaction_id));if(e&&e.extension&&Moxtra._safeUrl&&(Moxtra._safeExtension=e.extension,delete e.extension),e&&e.extension)try{var c=JSON.stringify(e.extension);s=s+"&extension="+encodeURIComponent(c)}catch(e){console.warn(e.message)}if(Moxtra.accessToken&&e&&(e.options||e.extension)&&(t={},e.options&&(t.options=e.options),e.extension&&(t.extension=e.extension),t.exp=Date.now()+18e4,c=Moxtra_CryptoJS.enc.Utf8.parse(JSON.stringify({alg:"HS256",typ:"JWT"})),c=Moxtra_CryptoJS.enc.Base64.stringify(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,""),t=Moxtra_CryptoJS.enc.Utf8.parse(JSON.stringify(t)),c=c+"."+Moxtra_CryptoJS.enc.Base64.stringify(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,""),t=Moxtra_CryptoJS.HmacSHA256(c,Moxtra.accessToken),s=s+"&cjwt="+(c+"."+Moxtra_CryptoJS.enc.Base64.stringify(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,""))),Moxtra._pluginversion&&(s=s+"&plugin_version="+Moxtra._pluginversion),Moxtra._theme&&(s=s+"&theme="+encodeURIComponent(Moxtra._theme)),e&&e.tags_include){var l="",m="";e.tags_include instanceof Array?m=e.tags_include[0]:"string"==typeof e.tags_include&&(m=e.tags_include);for(var _=m.split(","),p=0;p<_.length;p++)void 0!==_[p]&&(0<p&&(l+=","),l+="API_"+_[p]);0<l.length&&(s=s+"&tags_include="+l)}if(e&&e.tags_exclude){var f="",m="";e.tags_exclude instanceof Array?m=e.tags_exclude[0]:"string"==typeof e.tags_exclude&&(m=e.tags_exclude);for(var u=m.split(","),p=0;p<u.length;p++)void 0!==u[p]&&(0<p&&(f+=","),f+="API_"+u[p]);0<f.length&&(s=s+"&tags_exclude="+f)}return e&&e.access_token&&(Moxtra.autostart||!Moxtra.hideAccessTokenFromUrl)?o=s+"&access_token="+e.access_token:!Moxtra.accessToken||!Moxtra.autostart&&Moxtra.hideAccessTokenFromUrl?Moxtra.appKey?Moxtra._barlogin?o=s:(o=Moxtra.ssoUrl+"?idpid="+Moxtra.appKey+"&target="+encodeURIComponent(s),Moxtra.partnerId?o+="&partnerid="+Moxtra.partnerId:Moxtra.orgId&&(o+="&orgid="+Moxtra.orgId)):o=e&&e.token?Moxtra.baseUrl+Moxtra.version+"/#login?token="+encodeURIComponent(e.token)+"&loginUrl="+encodeURIComponent(e.loginUrl)+"&type="+r+"&client_id="+Moxtra.clientId+"&origin="+a+"&backUrl="+encodeURIComponent(s):s:o=s+"&access_token="+Moxtra.accessToken,Moxtra.hideAccessTokenFromUrl&&!Moxtra.autostart&&(o+="&security=true"),o},Moxtra._padLeft=function(e,t,r){return e.length>=t?e:Moxtra._padLeft(r+e,t,r||" ")},Moxtra._s4=function(e){e=e.toString(16);return Moxtra._padLeft(e,4,"0")},Moxtra._cryptoGuid=function(){var e=new window.Uint16Array(8);return window.crypto.getRandomValues(e),[Moxtra._s4(e[0])+Moxtra._s4(e[1]),Moxtra._s4(e[2]),Moxtra._s4(e[3]),Moxtra._s4(e[4]),Moxtra._s4(e[5])+Moxtra._s4(e[6])+Moxtra._s4(e[7])].join("-")},Moxtra._plainGuid=function(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"===e?t:7&t|8).toString(16)})},Moxtra._guid=function(){var e=void 0!==window.crypto,t=void 0!==window.crypto.getRandomValues;return e&&t?Moxtra._cryptoGuid():Moxtra._plainGuid()},Moxtra._parseURL=function(e){for(var t,r=/[?#&]([^=#]+)=([^&#]*)/g,o={};t=r.exec(e);)o[t[1]]=t[2];return o},Moxtra._browserSpecs=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?{name:e[1].replace("OPR","Opera"),version:e[2]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})},Moxtra._OSInfo=function(){return{init:function(){return this.searchString(this.dataOS)},searchString:function(e){for(var t=0;t<e.length;t++){var r=e[t].string,o=e[t].prop;if(r){if(-1!=r.indexOf(e[t].subString))return e[t].identity}else if(o)return e[t].identity}},dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"macOS"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}.init()},Moxtra._handleMessageFromChatEvent=function(e,t){switch(e.action){case"end":case"leave_as_ended":return Moxtra._popupbychat&&(Moxtra.isIE()?(Moxtra._popupbychat.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._popupbychat)):Moxtra._popupbychat.close()),Moxtra._popupbychat=null,"function"==typeof t.end?t.end(e):"function"==typeof t.end_meet?t.end_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetEnd",!1,!1),Moxtra._meet.dispatchEvent(m)),!0;case"leave":return Moxtra._popupbychat&&(Moxtra.isIE()?(Moxtra._popupbychat.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._popupbychat)):Moxtra._popupbychat.close()),Moxtra._popupbychat=null,"function"==typeof t.exit?t.exit(e):"function"==typeof t.exit_meet?t.exit_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetExit",!1,!1),Moxtra._meet.dispatchEvent(m)),!0;case"save_note":return Moxtra._notepopupbychat&&(Moxtra.isIE()?(Moxtra._notepopupbychat.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._notepopupbychat)):Moxtra._notepopupbychat.close()),Moxtra._notepopupbychat=null,"function"==typeof t.save_note?t.save_note(e):Moxtra._note&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("NoteSave",!1,!1),m.destination_binder_id=e.destination_binder_id,m.download_url=e.download_url,m.share_url=e.share_url,Moxtra._note.dispatchEvent(m)),!0;case"cancel_note":return Moxtra._notepopupbychat&&(Moxtra.isIE()?(Moxtra._notepopupbychat.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._notepopupbychat)):Moxtra._notepopupbychat.close()),Moxtra._notepopupbychat=null,"function"==typeof t.cancel?t.cancel(e):"function"==typeof t.cancel_note?t.cancel_note(e):Moxtra._note&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("NoteCancel",!1,!1),Moxtra._note.dispatchEvent(m)),!0;case"invalidToken":return Moxtra._invalidTokenSessionMap[e.session_id]||(Moxtra._invalidTokenSessionMap[e.session_id]=e.session_id,Moxtra._handleInvalidToken&&"function"==typeof Moxtra._handleInvalidToken&&Moxtra._handleInvalidToken(e)),!0;default:return Moxtra._handleMessageEvent(e,t)}},Moxtra._handleViewMessageEvent=function(e,t,r){switch(e.action){case"fail":return"function"==typeof t.error?(t.error(e),!1):!1;case"view":return"chat"===r?"function"==typeof t.start_chat&&t.start_chat(e):"page"===r?"function"==typeof t.start_page&&t.start_page(e):"todo"===r?"function"==typeof t.start_todo&&t.start_todo(e):"meet"===r?"function"==typeof t.start_meetview&&t.start_meetview(e):"timeline"===r&&"function"==typeof t.view_binder&&t.view_binder(e),!1;case"view_share_link":return"function"==typeof t.view_share_link&&t.view_share_link(e),!1;case"request_view_binder":return"function"==typeof t.request_view_binder&&t.request_view_binder(e),!1;case"view_binder_page":return"function"==typeof t.view_binder_page&&t.view_binder_page(e),!1;case"list":return"function"==typeof t.start_timeline&&t.start_timeline(e),!1;case"request_open_webnote":return"function"==typeof t.request_open_webnote&&t.request_open_webnote(e),!1;case"request_close_webnote":return"function"==typeof t.request_close_webnote&&t.request_close_webnote(e),!1;case"request_note":return t.autostart_note?(t.from_chat=!0,t.iframe=!1,t.binder_id=e.binder_id,t.page_index=e.page_index,Moxtra.autostart=!0,Moxtra.note(t)):(Moxtra.autostart=!1,"function"==typeof t.request_note&&t.request_note(e)),!1;case"share":return"function"==typeof t.share&&t.share(e),!1;case"invalidToken":var o;return t&&(t.iframe&&!0===t.iframe?(t.tagid4iframe&&(o=document.getElementById(t.tagid4iframe))&&t.handle_iframe&&(o.removeChild(t.handle_iframe),t.handle_iframe=null),o||t.handle_iframe&&(document.body.removeChild(t.handle_iframe),t.handle_iframe=null)):t.handle_popup&&(Moxtra.isIE()?(t.handle_popup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(t.handle_popup)):t.handle_popup.close(),t.handle_popup=null)),Moxtra._invalidTokenSessionMap[e.session_id]||(Moxtra._invalidTokenSessionMap[e.session_id]=e.session_id,Moxtra._handleInvalidToken&&"function"==typeof Moxtra._handleInvalidToken&&Moxtra._handleInvalidToken(e)),!0;case"feed_update_self":return"function"==typeof t.publish_feed&&t.publish_feed(e),!1;case"feed_update":return"function"==typeof t.receive_feed&&t.receive_feed(e),!1;case"request_view_member":return"chat"===r&&"function"==typeof t.request_view_member&&t.request_view_member(e),!1;case"request_meet":return t.autostart_meet?(t.binder_id=e.binder_id,t.iframe=!1,Moxtra.autostart=!0,Moxtra.meet(t)):(Moxtra.autostart=!1,"function"==typeof t.request_meet&&t.request_meet(e)),!1;case"need_install_firefox_extension":return moxo_downloadURI(e.download_url,"download extension"),!1;case"auth_2fa_request":return"function"==typeof t.auth_2fa_request&&(Moxtra._auth2faMap[e.request_id]=t,Moxtra_Session.set("2fa_"+e.request_id,t),t.auth_2fa_request(e)),!1;default:if("function"==typeof t[e.action])return t[e.action](e),!1;if("meet"===r&&t.autostart_meet)return Moxtra._handleMessageEvent(e,t)}if(t.extension&&t.extension.menus&&t.extension.menus[0].add_page)for(var a=0;a<t.extension.menus[0].add_page.length;a++){var n=t.extension.menus[0].add_page[a];if(e.action==n.menu_name){"function"==typeof t.add_page?t.add_page(e):document.createEvent&&(m=document.createEvent("Event"),m.initEvent(n.menu_name,!1,!1),m.binder_id=e.binder_id,m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,window.dispatchEvent(m));break}}if(t.extension&&t.extension.menus&&t.extension.menus[0].page_action)for(a=0;a<t.extension.menus[0].page_action.length;a++){n=t.extension.menus[0].page_action[a];if(e.action==n.menu_name){"function"==typeof t.page_action?t.page_action(e):document.createEvent&&(m=document.createEvent("Event"),m.initEvent("page_action",!1,!1),m.action=e.action,m.binder_id=e.binder_id,m.session_id=e.session_id,m.download_url=e.download_url,window.dispatchEvent(m));break}}return!1},Moxtra._handleChatMessageEvent=function(e,t,r){switch(e.action){case"fail":return"function"==typeof t.error?(t.error(e),!1):(r?Moxtra._chat&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("ChatError",!1,!1),m.error_code=e.error_code,m.error_message=e.error_message,Moxtra._chat.dispatchEvent(m)):Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("TimelineError",!1,!1),m.error_code=e.error_code,m.error_message=e.error_message,Moxtra._timeline.dispatchEvent(m)),!1);case"view":return r?"function"==typeof t.start_chat?t.start_chat(e):Moxtra._chat&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("ChatStart",!1,!1),m.binder_id=e.binder_id,m.session_id=e.session_id,Moxtra._chat.dispatchEvent(m)):"function"==typeof t.view_binder?t.view_binder(e):Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("BinderView",!1,!1),m.binder_id=e.binder_id,m.session_id=e.session_id,Moxtra._timeline.dispatchEvent(m)),!1;case"list":return"function"==typeof t.start_timeline?t.start_timeline(e):Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("TimelineStart",!1,!1),m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._timeline.dispatchEvent(m)),!1;case"create_binder":return"function"==typeof t.create_binder?t.create_binder(e):Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("BinderCreate",!1,!1),m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._timeline.dispatchEvent(m)),!1;case"delete_binder":return"function"==typeof t.delete_binder?t.delete_binder(e):Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("BinderDelete",!1,!1),m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._timeline.dispatchEvent(m)),!1;case"leave_binder":return"function"==typeof t.leave_binder?t.leave_binder(e):(Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("BinderUserLeave",!1,!1),m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._timeline.dispatchEvent(m)),Moxtra._chat&&document.createEvent&&(m.initEvent("BinderUserLeave",!1,!1),m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._chat.dispatchEvent(m))),!1;case"remove_binder_user":return"function"==typeof t.remove_binder_user?t.remove_binder_user(e):(Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("BinderUserRemove",!1,!1),m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._timeline.dispatchEvent(m)),Moxtra._chat&&document.createEvent&&(m.initEvent("BinderUserRemove",!1,!1),m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._chat.dispatchEvent(m))),!1;case"request_meet":return t.autostart_meet?(t.binder_id=e.binder_id,t.from_chat=!0,t.iframe=!1,Moxtra.autostart=!0,Moxtra.meet(t)):(Moxtra.autostart=!1,"function"==typeof t.request_meet?t.request_meet(e):r?Moxtra._chat&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetRequest",!1,!1),m.binder_id=e.binder_id,Moxtra._chat.dispatchEvent(m)):Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetRequest",!1,!1),m.binder_id=e.binder_id,Moxtra._timeline.dispatchEvent(m))),!1;case"request_note":return t.autostart_note?(t.from_chat=!0,t.iframe=!1,t.binder_id=e.binder_id,t.page_index=e.page_index,Moxtra.autostart=!0,Moxtra.note(t)):(Moxtra.autostart=!1,"function"==typeof t.request_note?t.request_note(e):r?Moxtra._chat&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("NoteRequest",!1,!1),Moxtra._chat.dispatchEvent(m)):Moxtra._timeline&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("NoteRequest",!1,!1),Moxtra._timeline.dispatchEvent(m))),!1;case"invite":return"function"==typeof t.invite_member?t.invite_member(e):(Moxtra._chat||Moxtra._timeline)&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MemberInvite",!1,!1),m.binder_id=e.binder_id,(Moxtra._chat||Moxtra._timeline).dispatchEvent(m)),!1;case"share":return"function"==typeof t.share&&t.share(e),!1;case"request_join_meet":return"function"==typeof t.request_join_meet&&t.request_join_meet(e),!1;case"invalidToken":var o;return t&&(t.iframe&&!0===t.iframe?(t.tagid4iframe&&(o=document.getElementById(t.tagid4iframe))&&t.handle_iframe&&(o.removeChild(t.handle_iframe),t.handle_iframe=null),o||t.handle_iframe&&(document.body.removeChild(t.handle_iframe),t.handle_iframe=null)):t.handle_popup&&(Moxtra.isIE()?(t.handle_popup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(t.handle_popup)):t.handle_popup.close(),t.handle_popup=null)),Moxtra._invalidTokenSessionMap[e.session_id]||(Moxtra._invalidTokenSessionMap[e.session_id]=e.session_id,Moxtra._handleInvalidToken&&"function"==typeof Moxtra._handleInvalidToken&&Moxtra._handleInvalidToken(e)),!0;case"feed_update_self":return"function"==typeof t.publish_feed&&t.publish_feed(e),!1;case"feed_update":return"function"==typeof t.receive_feed&&t.receive_feed(e),!1;case"auth_2fa_request":return"function"==typeof t.auth_2fa_request&&(Moxtra._auth2faMap[e.request_id]=t,Moxtra_Session.set("2fa_"+e.request_id,t),t.auth_2fa_request(e)),!1;default:if("function"==typeof t[e.action])return t[e.action](e),!1}if(t.extension&&t.extension.menus&&t.extension.menus[0].add_page)for(var a=0;a<t.extension.menus[0].add_page.length;a++){var n=t.extension.menus[0].add_page[a];if(e.action==n.menu_name){"function"==typeof t.add_page?t.add_page(e):document.createEvent&&(m=document.createEvent("Event"),m.initEvent(n.menu_name,!1,!1),m.binder_id=e.binder_id,m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,window.dispatchEvent(m));break}}if(t.extension&&t.extension.menus&&t.extension.menus[0].page_action)for(a=0;a<t.extension.menus[0].page_action.length;a++){n=t.extension.menus[0].page_action[a];if(e.action==n.menu_name){"function"==typeof t.page_action?t.page_action(e):document.createEvent&&(m=document.createEvent("Event"),m.initEvent("page_action",!1,!1),m.action=e.action,m.binder_id=e.binder_id,m.session_id=e.session_id,m.download_url=e.download_url,window.dispatchEvent(m));break}}return!1},Moxtra._handleMessageEvent=function(e,t){switch(e.action){case"start":case"join":return Moxtra.session_key=e.session_key,Moxtra.meet_id=e.meet_id,Moxtra.session_id=e.session_id,Moxtra.joinURL=Moxtra.getJoinMeetURL(e.session_key||e.meet_id,t.user_name,"websdk",t),t.iframe&&!0===t.iframe?t.no_refresh||t.from_chat||(t.refresh_binder_id=e.binder_id,t.session_key=e.session_key,Moxtra_Session.set("meet_refresh",t)):Moxtra_Session.remove("meet_refresh"),"function"==typeof t.success?t.success(e):"function"==typeof t.start_meet?t.start_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetSuccess",!1,!1),m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,Moxtra._meet.dispatchEvent(m)),!1;case"resume_meet":return Moxtra.session_key=e.session_key,Moxtra.meet_id=e.meet_id,"function"==typeof t.resume_meet?t.resume_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetResume",!1,!1),m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,Moxtra._meet.dispatchEvent(m)),!1;case"end":case"leave_as_ended":return t&&(t.iframe&&!0===t.iframe&&Moxtra._iframe?(t.tagid4iframe&&(r=document.getElementById(t.tagid4iframe))&&r.removeChild(Moxtra._iframe),r||document.body.removeChild(Moxtra._iframe),Moxtra._iframe=null):(Moxtra._popup&&(Moxtra.isIE()?(Moxtra._popup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._popup)):Moxtra._popup.close()),Moxtra._popup=null)),Moxtra.session_id=null,Moxtra.session_key=null,Moxtra_Session.remove("meet_refresh"),"function"==typeof t.end?t.end(e):"function"==typeof t.end_meet?t.end_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetEnd",!1,!1),Moxtra._meet.dispatchEvent(m)),!0;case"leave":return t&&(t.iframe&&!0===t.iframe?(t.tagid4iframe&&(r=document.getElementById(t.tagid4iframe))&&r.removeChild(Moxtra._iframe),r||document.body.removeChild(Moxtra._iframe),Moxtra._iframe=null):(Moxtra._popup&&(Moxtra.isIE()?(Moxtra._popup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._popup)):Moxtra._popup.close()),Moxtra._popup=null)),Moxtra.session_id=null,Moxtra.session_key=null,Moxtra_Session.remove("meet_refresh"),"function"==typeof t.exit?t.exit(e):"function"==typeof t.exit_meet?t.exit_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetExit",!1,!1),Moxtra._meet.dispatchEvent(m)),!0;case"invite":return e.session_key?"function"==typeof t.invite?t.invite(e):"function"==typeof t.invite_meet?t.invite_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetInvite",!1,!1),m.binder_id=e.binder_id,m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,Moxtra._meet.dispatchEvent(m)):"function"==typeof t.invite_member?t.invite_member(e):(Moxtra._chat||Moxtra._timeline)&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MemberInvite",!1,!1),m.binder_id=e.binder_id,(Moxtra._chat||Moxtra._timeline).dispatchEvent(m)),!1;case"invited":return"function"==typeof t.invited?t.invited(e):"function"==typeof t.invited_meet?t.invited_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MemberInvited",!1,!1),m.binder_id=e.binder_id,m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,Moxtra._meet.dispatchEvent(m)),!1;case"save":return"function"==typeof t.save?t.save(e):"function"==typeof t.save_meet?t.save_meet(e):Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetSaved",!1,!1),m.binder_id=e.binder_id,m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,Moxtra._meet.dispatchEvent(m)),!1;case"share":return"function"==typeof t.share&&t.share(e),!1;case"start_note":return t.from_chat||(t.noterefresh_binder_id=e.binder_id,Moxtra_Session.set("note_refresh",t)),"function"==typeof t.start_note?t.start_note(e):Moxtra._note&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("NoteStart",!1,!1),m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,Moxtra._note.dispatchEvent(m)),!1;case"save_note":return t&&(t.iframe&&!0===t.iframe?(t.tagid4iframe&&(r=document.getElementById(t.tagid4iframe))&&r.removeChild(Moxtra._noteiframe),r||document.body.removeChild(Moxtra._noteiframe),Moxtra._noteiframe=null):(Moxtra._notepopup&&(Moxtra.isIE()?(Moxtra._notepopup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._notepopup)):Moxtra._notepopup.close()),Moxtra._notepopup=null)),Moxtra_Session.remove("note_refresh"),"function"==typeof t.save_note?t.save_note(e):Moxtra._note&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("NoteSave",!1,!1),m.destination_binder_id=e.destination_binder_id,m.download_url=e.download_url,m.share_url=e.share_url,Moxtra._note.dispatchEvent(m)),!0;case"fail":return("function"==typeof t.error&&t.error(e),e.is_chat)?(m=document.createEvent("Event"),m.initEvent("ChatError",!1,!1),m.error_code=e.error_code,m.error_message=e.error_message,Moxtra._chat.dispatchEvent(m),!1):(Moxtra.session_id&&e.session_id===Moxtra.session_id?Moxtra._meet&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("MeetError",!1,!1),m.error_code=e.error_code,m.error_message=e.error_message,Moxtra._meet.dispatchEvent(m)):Moxtra._note&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("NoteError",!1,!1),m.error_code=e.error_code,m.error_message=e.error_message,Moxtra._note.dispatchEvent(m)),!1);case"cancel_note":return t&&(t.iframe&&!0===t.iframe?(t.tagid4iframe&&(r=document.getElementById(t.tagid4iframe))&&r.removeChild(Moxtra._noteiframe),r||document.body.removeChild(Moxtra._noteiframe),Moxtra._noteiframe=null):(Moxtra._notepopup&&(Moxtra.isIE()?(Moxtra._notepopup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._notepopup)):Moxtra._notepopup.close()),Moxtra._notepopup=null)),Moxtra_Session.remove("note_refresh"),"function"==typeof t.cancel?t.cancel(e):"function"==typeof t.cancel_note?t.cancel_note(e):Moxtra._note&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("NoteCancel",!1,!1),Moxtra._note.dispatchEvent(m)),!0;case"start_annotate":return"function"==typeof t.start_annotate?t.start_annotate(e):Moxtra._annotate&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("AnnotateStart",!1,!1),m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._annotate.dispatchEvent(m)),!1;case"stop_annotate":return t&&(t.iframe&&!0===t.iframe?(t.tagid4iframe&&(r=document.getElementById(t.tagid4iframe))&&t.handle_iframe&&(r.removeChild(t.handle_iframe),t.handle_iframe=null),r||Moxtra._annotateiframe&&(document.body.removeChild(Moxtra._annotateiframe),Moxtra._annotateiframe=null)):t.handle_popup&&(Moxtra.isIE()?(t.handle_popup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(t.handle_popup)):t.handle_popup.close(),t.handle_popup=null)),"function"==typeof t.stop_annotate?t.stop_annotate(e):Moxtra._annotate&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("AnnotateStop",!1,!1),m.download_url=e.download_url,m.share_url=e.share_url,m.binder_id=e.binder_id,Moxtra._annotate.dispatchEvent(m)),!0;case"invalidToken":var r;return t&&(t.iframe&&!0===t.iframe?(t.tagid4iframe&&(r=document.getElementById(t.tagid4iframe))&&t.handle_iframe&&(r.removeChild(t.handle_iframe),t.handle_iframe=null),r||Moxtra._annotateiframe&&(document.body.removeChild(Moxtra._annotateiframe),Moxtra._annotateiframe=null)):t.handle_popup&&(Moxtra.isIE()?(t.handle_popup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(t.handle_popup)):t.handle_popup.close(),t.handle_popup=null)),Moxtra._invalidTokenSessionMap[e.session_id]||(Moxtra._invalidTokenSessionMap[e.session_id]=e.session_id,Moxtra._handleInvalidToken&&"function"==typeof Moxtra._handleInvalidToken&&Moxtra._handleInvalidToken(e)),!0;case"need_install_firefox_extension":return moxo_downloadURI(e.download_url,"download extension"),!1;case"message":return Moxtra._handleReceiveMessage&&"function"==typeof Moxtra._handleReceiveMessage&&Moxtra._handleReceiveMessage(e),!1;default:if("function"==typeof t[e.action])return t[e.action](e),!1}if(t.extension&&t.extension.menus&&t.extension.menus[0].add_page)for(var o=0;o<t.extension.menus[0].add_page.length;o++){var a=t.extension.menus[0].add_page[o];if(e.action==a.menu_name){"function"==typeof t.add_page?t.add_page(e):document.createEvent&&(m=document.createEvent("Event"),m.initEvent(a.menu_name,!1,!1),m.binder_id=e.binder_id,m.session_key=e.session_key,m.meet_id=e.meet_id,m.session_id=e.session_id,window.dispatchEvent(m));break}}if(t.extension&&t.extension.menus&&t.extension.menus[0].page_action)for(o=0;o<t.extension.menus[0].page_action.length;o++){a=t.extension.menus[0].page_action[o];if(e.action==a.menu_name){"function"==typeof t.page_action?t.page_action(e):document.createEvent&&(m=document.createEvent("Event"),m.initEvent("page_action",!1,!1),m.action=e.action,m.binder_id=e.binder_id,m.session_id=e.session_id,m.download_url=e.download_url,window.dispatchEvent(m));break}}return!1},Moxtra._handleDSMessageEvent=function(e,t){switch(e.action){case"invalidToken":return t.tagid4iframe&&((r=document.getElementById(t.tagid4iframe))&&t.handle_iframe&&(r.removeChild(t.handle_iframe),t.handle_iframe=null),delete Moxtra._meetScreenShareTag),r||t.handle_iframe&&(document.body.removeChild(t.handle_iframe),t.handle_iframe=null,delete Moxtra._meetScreenShareiframe),Moxtra._invalidTokenSessionMap[e.session_id]||(Moxtra._invalidTokenSessionMap[e.session_id]=e.session_id,Moxtra._handleInvalidToken&&"function"==typeof Moxtra._handleInvalidToken&&Moxtra._handleInvalidToken(e)),!0;case"env_ready":case"browser_unsupported":case"os_unsupported":case"need_extension":case"need_plugin":return Moxtra._meetPrepareiframe&&(document.body.removeChild(Moxtra._meetPrepareiframe),delete Moxtra._meetPrepareiframe),"function"==typeof t[e.action]&&t[e.action](e),!0;case"start_screen_share":return Moxtra.ds_session_key=e.session_key,Moxtra.ds_session_id=e.session_id,"function"==typeof t[e.action]&&t[e.action](e),!1;case"join_screen_share":return Moxtra.attds_session_key=e.session_key,Moxtra.attds_session_id=e.session_id,"function"==typeof t[e.action]&&t[e.action](e),!1;case"fail":case"stop_screen_share":case"leave_screen_share":var r;return t.tagid4iframe&&((r=document.getElementById(t.tagid4iframe))&&t.handle_iframe&&(r.removeChild(t.handle_iframe),t.handle_iframe=null,delete Moxtra._viewMap[t.tagid4iframe],delete Moxtra._handlerMap[t.tagid4iframe]),delete Moxtra._meetScreenShareTag),r||t.handle_iframe&&(document.body.removeChild(t.handle_iframe),t.handle_iframe=null,delete Moxtra._meetScreenShareiframe,delete Moxtra._meetScreenSharefunc),"stop_screen_share"==e.action&&(Moxtra.ds_session_key=null,Moxtra.ds_session_id=null),"leave_screen_share"==e.action&&(Moxtra.attds_session_key=null,Moxtra.attds_session_id=null),"function"==typeof t[e.action]&&t[e.action](e),!0;default:if("function"==typeof t[e.action])return t[e.action](e),!1}if(t.extension&&t.extension.menus&&t.extension.menus[0].page_action)for(var o=0;o<t.extension.menus[0].page_action.length;o++){var a=t.extension.menus[0].page_action[o];if(e.action==a.menu_name){"function"==typeof t.page_action?t.page_action(e):document.createEvent&&(m=document.createEvent("Event"),m.initEvent("page_action",!1,!1),m.action=e.action,m.binder_id=e.binder_id,m.session_id=e.session_id,m.download_url=e.download_url,window.dispatchEvent(m));break}}return!1},Moxtra._handleVideoMessageEvent=function(e,t){switch(e.action){case"video_joined":return Moxtra.video_session_key=e.session_key,Moxtra.video_access_token=t.access_token,t.no_refresh||(t.videorefresh_session_key=e.session_key,Moxtra_Session.set("video_refresh",t)),"function"==typeof t.start_video?t.start_video(e):Moxtra._video&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("VideoStart",!1,!1),m.session_key=e.session_key,m.session_id=e.session_id,m.binder_id=e.binder_id,Moxtra._video.dispatchEvent(m)),!1;case"end":case"leave":case"leave_as_ended":case"video_left":var r;return t&&(t.iframe&&!0===t.iframe?(t.tagid4iframe&&(r=document.getElementById(t.tagid4iframe))&&r.removeChild(Moxtra._videoiframe),r||document.body.removeChild(Moxtra._videoiframe),Moxtra._videoiframe=null):(Moxtra._videopopup&&(Moxtra.isIE()?(Moxtra._videopopup.contentWindow.postMessage("close",Moxtra.baseUrl),document.body.removeChild(Moxtra._videopopup)):Moxtra._videopopup.close()),Moxtra._videopopup=null)),Moxtra.video_session_key=null,Moxtra.video_access_token=null,Moxtra_Session.remove("video_refresh"),"function"==typeof t.end_video?t.end_video(e):Moxtra._video&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("VideoEnd",!1,!1),m.session_id=e.session_id,Moxtra._video.dispatchEvent(m)),!0;case"video_broadcasted":return"function"==typeof t.camera_on?t.camera_on(e):Moxtra._video&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("CameraOn",!1,!1),m.session_id=e.session_id,Moxtra._video.dispatchEvent(m)),!1;case"video_unbroadcasted":return"function"==typeof t.camera_off?t.camera_off(e):Moxtra._video&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("CameraOff",!1,!1),m.session_id=e.session_id,Moxtra._video.dispatchEvent(m)),!1;case"fail":return"function"==typeof t.error?(t.error(e),!1):(e.is_chat&&(m=document.createEvent("Event"),m.initEvent("ChatError",!1,!1),m.error_code=e.error_code,m.error_message=e.error_message,Moxtra._chat.dispatchEvent(m)),!1);case"invalidToken":return Moxtra._invalidTokenSessionMap[e.session_id]||(Moxtra._invalidTokenSessionMap[e.session_id]=e.session_id,Moxtra._handleInvalidToken&&"function"==typeof Moxtra._handleInvalidToken&&Moxtra._handleInvalidToken(e)),!0;default:if("function"==typeof t[e.action])return t[e.action](e),!1}return!1},Moxtra._handleDataMessageEvent=function(e,t){switch(e.action){case"all_binders":return"function"==typeof t.all_binders&&t.all_binders(e),!1;case"added_binders":return"function"==typeof t.added_binders&&t.added_binders(e),!1;case"updated_binders":return"function"==typeof t.updated_binders&&t.updated_binders(e),!1;case"removed_binders":return"function"==typeof t.removed_binders&&t.removed_binders(e),!1;case"fail":return"function"==typeof t.error&&t.error(e),!1;case"invalidToken":return Moxtra._invalidTokenSessionMap[e.session_id]||(Moxtra._invalidTokenSessionMap[e.session_id]=e.session_id,Moxtra._handleInvalidToken&&"function"==typeof Moxtra._handleInvalidToken&&Moxtra._handleInvalidToken(e)),!0;case"feed_update_self":return"function"==typeof t.publish_feed&&t.publish_feed(e),!1;case"feed_update":return"function"==typeof t.receive_feed&&t.receive_feed(e),!1;case"request_view_member":return"function"==typeof t.request_view_member&&t.request_view_member(e),!1;default:if("function"==typeof t[e.action])return t[e.action](e),!1}return!1},Moxtra._handleAuditMessageEvent=function(e,t,r){return e.action,"function"==typeof t[e.action]&&t[e.action](e),!1},Moxtra._handleTransactionMessageEvent=function(e,t,r){return e.action,"function"==typeof t[e.action]&&t[e.action](e),!1},Moxtra._analytics=function(e,t,r){var o=(new Date).getTime(),r={category:"web",client_id:Moxtra.clientId,api_name:e,start_time:t,end_time:o,status_code:r};try{var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.onreadystatechange=function(){4==a.readyState&&a.status},a.open("POST","/sdkae/update",!0),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(r))}catch(e){}},Moxtra._ajax=function(e,t,r,o,a){var n,i={};if(r)for(var s in r)i[s]=r[s];(n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){4==n.readyState&&(200==n.status?o&&o(JSON.parse(n.responseText)):a&&a(JSON.parse(n.responseText)))},n.open(e,t,!0),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(i))},Moxtra._getMembers=function(e,a,t){var n=[];Moxtra._ajax("GET",Moxtra.baseUrl+"/board/"+e,null,function(e){var t=e.object.board.users;if(t)for(var r,o=0;o<t.length;o++)t[o].user&&((r={}).sequence=t[o].sequence,r.id=t[o].user.id,r.name=t[o].user.name,r.email=t[o].user.email,r.email_verified=t[o].user.email_verified,r.first_name=t[o].user.first_name,r.last_name=t[o].user.last_name,n.push(r));a&&"function"==typeof a&&a(n)},function(e){t&&"function"==typeof t&&t(e.message)})},Moxtra.isBrowserSupported=function(){return os=Moxtra._OSInfo(),"Linux"!=os&&(env=Moxtra._browserSpecs(),"Chrome"==env.name&&19<=env.version||"Safari"==env.name&&6<=env.version||"Opera"==env.name&&12<=env.version||"Firefox"==env.name&&12<=env.version||"IE"==env.name&&9<=env.version||!1)},Moxtra.setup=function(a){if(!a)throw"You must pass in options";if(a.clientId&&(Moxtra.clientId=a.clientId),!Moxtra.clientId)throw"You have to set clientId";if(a.base_url)Moxtra.baseUrl=a.base_url;else if("production"===a.mode)Moxtra.baseUrl=Moxtra._generateDomain("www","prod");else if("sandbox"===a.mode)Moxtra.baseUrl=Moxtra._generateDomain("sandbox","prod");else if("debug"===a.mode)Moxtra.baseUrl=Moxtra._generateDomain("www","dev");else if("beta"===a.mode)Moxtra.baseUrl=Moxtra._generateDomain("beta","prod");else{if("local"!==a.mode)return void alert("Please specify mode!");Moxtra.baseUrl=window.location.protocol+"//"+window.location.host}if(!(a&&a.uniqueid&&a.signature&&a.timestamp))throw"You have to set uniqueid, signature, and timestamp";var e=Moxtra.baseUrl+"/oauthapi/token?client_id="+Moxtra.clientId+"&uniqueid="+encodeURIComponent(a.uniqueid)+"&timestamp="+a.timestamp+"&signature="+a.signature;a.firstname&&(e+="&firstname="+encodeURIComponent(a.firstname)),a.lastname&&(e+="&lastname="+encodeURIComponent(a.lastname)),a.orgid&&(e+="&orgid="+encodeURIComponent(a.orgid)),a.pictureurl&&(e+="&pictureurl="+encodeURIComponent(a.pictureurl)),a.timezone&&(e+="&timezone="+encodeURIComponent(a.timezone)),a.plancode&&(e+="&plancode="+encodeURIComponent(a.plancode)),a.language&&(e+="&language="+encodeURIComponent(a.language)),a.division&&(e+="&division="+encodeURIComponent(a.division)),a.department&&(e+="&department="+encodeURIComponent(a.department)),a.org_units&&(e+="&org_units="+encodeURIComponent(a.org_units)),jQuery.ajax({type:"GET",url:e,dataType:"jsonp",cache:!1,jsonpCallback:"verifyme",success:function(e,t,r){var o;e.access_token?"function"==typeof a.get_accesstoken&&a.get_accesstoken(e):"error"==e.status&&"function"==typeof a.error&&((o={error_code:"RESPONSE_ERROR"}).error_message=e.message,a.error(o))},error:function(e,t,r){var o;"function"==typeof a.error&&((o={error_code:"RESPONSE_ERROR"}).error_message=r,a.error(o))}})},Moxtra.logout=function(){0<=Moxtra.baseUrl.indexOf("grouphour")?(document.cookie="c_user=; path=/; expires="+new Date(0).toUTCString(),document.cookie="token=; path=/;  expires="+new Date(0).toUTCString(),document.cookie="sessionid=; path=/; expires="+new Date(0).toUTCString()):(document.cookie="c_user=; path=/;  expires="+new Date(0).toUTCString(),document.cookie="token=; path=/;  expires="+new Date(0).toUTCString(),document.cookie="sessionid=; path=/;  expires="+new Date(0).toUTCString())},Moxtra.init=function(e){if(e.base_url)Moxtra.baseUrl=e.base_url,Moxtra._isOnPremise=!0;else if("production"===e.mode)Moxtra.baseUrl=Moxtra._generateDomain("www","prod");else if("sandbox"===e.mode)Moxtra.baseUrl=Moxtra._generateDomain("sandbox","prod");else if("debug"===e.mode)Moxtra.baseUrl=Moxtra._generateDomain("www","dev");else if("beta"===e.mode)Moxtra.baseUrl=Moxtra._generateDomain("beta","prod");else{if("local"!==e.mode)return void alert("Please specify mode!");Moxtra.baseUrl=window.location.protocol+"//"+window.location.host}e.sdk_version?"3"==e.sdk_version?Moxtra.version="/service3":"4"==e.sdk_version?Moxtra.version="/service4":"5"==e.sdk_version?Moxtra.version="/service5":"latest"==e.sdk_version?Moxtra.version="/latest":"2"!=e.sdk_version&&(console.warn("Please set sdk_version to 2, 3, 4, or 5!"),Moxtra.version="/service"):Moxtra.version="/service","debug"===e.sdk_version&&e.base_url&&(Moxtra.version=""),e.client_id?(Moxtra.clientId=e.client_id,e.idp_id&&(Moxtra.appKey=e.idp_id),"idpdemo"==Moxtra.appKey?Moxtra.ssoUrl=Moxtra.baseUrl+"/sp/spdemo":Moxtra.ssoUrl=Moxtra.baseUrl+"/sp/startSSO",e.partner_id&&(Moxtra.partnerId=e.partner_id),e.org_id&&(Moxtra.orgId=e.org_id),e.access_token&&(Moxtra.accessToken=e.access_token),Moxtra.hideAccessTokenFromUrl=e.hideAccessTokenFromUrl,"function"==typeof e.invalid_token&&(Moxtra._handleInvalidToken=e.invalid_token),"function"==typeof e.receive_message&&(Moxtra._handleReceiveMessage=e.receive_message),e.plugin_version&&(Moxtra._pluginversion=e.plugin_version),e.theme&&(Moxtra._theme=e.theme),Moxtra._safeUrl=!!e.safe_url,Moxtra_Session.set("init_refresh",e)):alert("Please specify client_id!")},Moxtra._callIPCFrame=function(e,t){Moxtra.hideAccessTokenFromUrl&&e.addEventListener("load",function(){MIPC.create(window,e.contentWindow).registerCall("getAuthInfo",function(){return{access_token:Moxtra.accessToken,extension:Moxtra._safeExtension,moduleName:t}})})},Moxtra._createWidgetElement=function(e,t,r,o,a){var n,i,s;return a?(n=!1===t.border?a:a.getElementsByTagName("iframe")[0]).src=e:(n=document.createElement("iframe")).src=e,/#[a-z.]*/.test(e)&&(s=(s=e.match(/#[a-z.]*/)[0]||"").slice(1)),Moxtra._callIPCFrame(n,s),n.setAttribute("frameborder","0"),n.setAttribute("allowtransparency","true"),n.setAttribute("allow","geolocation; microphone; camera;display-capture"),t.scroll&&(n.style.overflow="scroll"),n.style.backgroundColor="transparent",n.style.width="100%",n.style.height="100%",!0===t.iframe&&t.tagid4iframe&&(i=document.getElementById(t.tagid4iframe))&&("none"==i.style.display&&console.warn("Tag "+t.tagid4iframe+" with 'none' display style might not work in Firefox"),!1===t.border&&(t.iframewidth?n.style.width=t.iframewidth:n.style.width=r?"850px":o?"330px":"1024px",t.iframeheight?n.style.height=t.iframeheight:n.style.height=r?"500px":"768px")),n.setAttribute("allowFullScreen",""),n.setAttribute("webkitAllowFullScreen",""),n.setAttribute("mozallowfullscreen",""),n.style.border="none",t.scroll&&(n.style.scrolling="yes"),n},Moxtra._createSimpleDivElement=function(e,t,r,o){var a=document.createElement("div");return e.iframewidth?a.style.width=e.iframewidth:a.style.width=r,e.iframeheight?a.style.height=e.iframeheight:a.style.height=o,a.style.margin="10px 0px",a.style.border="1px solid #ACACAC",a.style.boxShadow="rgba(0, 0, 0, .2) 0px 4px 16px",a.appendChild(t),a},Moxtra._createDivElement=function(e,t,r,o){var a=document.createElement("div");a.style.left=a.style.right=a.style.top=a.style.bottom="0px",a.style.zIndex="1000";var n=document.createElement("div");n.style.left=n.style.right=n.style.top=n.style.bottom="0px",n.style.backgroundColor="rgb(160, 160, 160)",n.style.opacity="0.2",n.style.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";o=Moxtra._createSimpleDivElement(e,t,r,o);return a.appendChild(n),a.appendChild(o),a},Moxtra._createHiddenIframe=function(e,t){var r,o=document.createElement("iframe");return o.src=e,o.setAttribute("frameborder","0"),o.style.width="100%",o.style.height="0",o.style.border="none",/#[a-z.]*/.test(e)&&(r=(r=e.match(/#[a-z.]*/)[0]||"").slice(1)),Moxtra._callIPCFrame(o,r),t&&(o.style.cssText="block !important;"+o.style.cssText),o},Moxtra.joinMeet=function(e){if(!e)throw"You must pass in options";var t="websdk";if(e.type&&(t=e.type),e.appKey&&(Moxtra.appKey=e.appKey),e.partnerId&&(Moxtra.partnerId=e.partnerId),e.orgId&&(Moxtra.orgId=e.orgId),e.clientId&&(Moxtra.clientId=e.clientId),(e.session_key||e.meet_id)&&(e.joinURL=Moxtra.getJoinMeetURL(e.session_key||e.meet_id,e.user_name,t,e)),!e.joinURL)throw"You must pass in session_key";Moxtra.meet(e)},Moxtra.endVideo=function(){var r=Moxtra._getMeetURL(!0,!1);r&&(ef=function(){var t=function(e){compareOrigin(e.origin)&&(Moxtra.removeListener(Moxtra._videohiddeniframe,"message",t),document.body.removeChild(Moxtra._videohiddeniframe),delete Moxtra._videohiddeniframe)},e=Moxtra._createHiddenIframe(r);Moxtra.addListener(e,"message",t),document.body.appendChild(e),Moxtra._videohiddeniframe=e},ef())},Moxtra.leaveVideo=function(){var r=Moxtra._getMeetURL(!1,!1);r&&(ef=function(){var t=function(e){compareOrigin(e.origin)&&(Moxtra.removeListener(Moxtra._videohiddeniframe,"message",t),document.body.removeChild(Moxtra._videohiddeniframe),delete Moxtra._videohiddeniframe)},e=Moxtra._createHiddenIframe(r);Moxtra.addListener(e,"message",t),document.body.appendChild(e),Moxtra._videohiddeniframe=e},ef())},Moxtra.leaveMeet=function(){var r=Moxtra._getMeetURL(!1,!0);r&&(ef=function(){var t=function(e){compareOrigin(e.origin)&&Moxtra._meethiddeniframe&&(Moxtra.removeListener(Moxtra._meethiddeniframe,"message",t),document.body.removeChild(Moxtra._meethiddeniframe),delete Moxtra._meethiddeniframe)},e=Moxtra._createHiddenIframe(r);Moxtra.addListener(e,"message",t),document.body.appendChild(e),Moxtra._meethiddeniframe=e},ef())},Moxtra.endMeet=function(r){(r=r||Moxtra._getMeetURL(!0,!0))&&(ef=function(){var t=function(e){compareOrigin(e.origin)&&Moxtra._hiddeniframe&&(Moxtra.removeListener(Moxtra._hiddeniframe,"message",t),document.body.removeChild(Moxtra._hiddeniframe),delete Moxtra._hiddeniframe)},e=Moxtra._createHiddenIframe(r);Moxtra.addListener(e,"message",t),document.body.appendChild(e),Moxtra._hiddeniframe=e},ef())},Moxtra.meet=Moxtra.meet||{},Moxtra.meet=function(i){var s,d,c,l,m,_;if(!i)throw"You must pass in options";var e=Moxtra_Session.get("init_refresh");Moxtra.checkRefreshInterval&&clearInterval(Moxtra.checkRefreshInterval),e||console.warn("You must call Moxtra.init() first");var p=Moxtra_Session.get("meet_refresh");if(p){if(!i.refresh_binder_id)return}else if(Moxtra._iframe)return;if(i.joinURL&&(Moxtra.joinURL=i.joinURL),i.appKey&&(Moxtra.appKey=i.appKey),i.partnerId&&(Moxtra.partnerId=i.partnerId),i.orgId&&(Moxtra.orgId=i.orgId),i.clientId&&(Moxtra.clientId=i.clientId),!Moxtra.clientId){if(i.error&&"function"==typeof i.error)return void i.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}Moxtra._timeMap.meet=(new Date).getTime(),ef=function(){var e,r,o,t,a,n=function(t){if(compareOrigin(t.origin))try{var e=JSON.parse(t.data);(i&&i.from_chat&&!0===i.from_chat?Moxtra._handleMessageFromChatEvent(e,i):Moxtra._handleMessageEvent(e,i))&&Moxtra.removeListener(window,"message",n)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}};Moxtra.addListener(window,"message",n),i.iframe&&!0===i.iframe?(_=Moxtra._createWidgetElement(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1),i,!1,!1),i.tagid4iframe?(r=function(){if(e=document.getElementById(i.tagid4iframe))!1===i.border?(e.appendChild(_),Moxtra._iframe=_):(s=Moxtra._createSimpleDivElement(i,_,"1024px","768px"),e.appendChild(s),Moxtra._iframe=s);else{if(p)return Moxtra_Session.remove("meet_refresh"),void _.remove();!1===i.border?(document.body.appendChild(_),(Moxtra._iframe=_).scrollIntoView(!0)):(c=Moxtra._createDivElement(i,_,"1024px","768px"),document.body.appendChild(c),(Moxtra._iframe=c).scrollIntoView(!0))}},p?(o=0,function e(){o++;var t=setTimeout(e,1e3);!document.getElementById(i.tagid4iframe)&&6!==o||(clearTimeout(t),r())}()):r()):!1===i.border?(document.body.appendChild(_),(Moxtra._iframe=_).scrollIntoView(!0)):(c=Moxtra._createDivElement(i,_,"1024px","768px"),document.body.appendChild(c),(Moxtra._iframe=c).scrollIntoView(!0))):(m=1024,d=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-m)/2,m=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-768)/2,!0===i.from_chat?Moxtra.isIE()?(t=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",t+=encodeURIComponent(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1)+"&popup=1"),t+="&name=moxtrabychat&others=",t+=encodeURIComponent("width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),a=Moxtra._createHiddenIframe(t),document.body.appendChild(a),Moxtra._popupbychat=a):(l=!0===i.tab?window.open(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1),"moxtrabychat","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0","_blank"):window.open(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1),"moxtrabychat","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),Moxtra._popupbychat=l):Moxtra.isIE()?(t=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",t+=encodeURIComponent(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1)+"&popup=1"),t+="&name=moxtra&others=",t+=encodeURIComponent("width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),a=Moxtra._createHiddenIframe(t),document.body.appendChild(a),Moxtra._popup=a):(l=!0===i.tab?window.open(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1),"moxtra","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0","_blank"):window.open(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1),"moxtra","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),Moxtra._popup=l),l&&l.focus())},ef()},Moxtra.meet.startRecord=function(){var e,t;if(Moxtra._iframe?(t=Moxtra._iframe.getElementsByTagName("iframe")[0])&&(e=t.contentWindow):Moxtra._popup?e=Moxtra._popup:Moxtra._popupbychat&&(e=Moxtra._popupbychat),!e)throw"Need an in-progress meeting";e.postMessage('{"action":"request", "type":"control_recording", "message":"record"}',Moxtra.baseUrl)},Moxtra.meet.pauseRecord=function(){var e,t;if(Moxtra._iframe?(t=Moxtra._iframe.getElementsByTagName("iframe")[0])&&(e=t.contentWindow):Moxtra._popup?e=Moxtra._popup:Moxtra._popupbychat&&(e=Moxtra._popupbychat),!e)throw"Need an in-progress meeting";e.postMessage('{"action":"request", "type":"control_recording", "message":"pause"}',Moxtra.baseUrl)},Moxtra.meet.changePresenter=function(e){if(!e)throw"Need a user";var t,r;if(Moxtra._iframe?(r=Moxtra._iframe.getElementsByTagName("iframe")[0])&&(t=r.contentWindow):Moxtra._popup?t=Moxtra._popup:Moxtra._popupbychat&&(t=Moxtra._popupbychat),!t)throw"Need an in-progress meeting";t.postMessage('{"action":"request", "type":"change_presenter", "message":"'+e+'"}',Moxtra.baseUrl)},Moxtra.postMessage=function(e,t,r,o){if(e&&r&&t&&o){var a,n,i=document.getElementById(e);if(i&&(Moxtra._viewMap[e]&&(n=i.getElementsByTagName("iframe")[0])?a=n.contentWindow:i=null),i){t={action:"request",type:"post_binder_comment",message:o,session_id:r,binder_id:t};try{a.postMessage(JSON.stringify(t),Moxtra.baseUrl)}catch(e){console.warn("post message error: "+e.message)}}else console.warn("No such iframe in tag: "+e)}else console.warn("Invalid input!")},Moxtra.message=Moxtra.message||{},Moxtra.message.sendAll=function(e){if(!e)throw"You must pass in options";if(!Moxtra._iframe&&!Moxtra._popup&&!Moxtra._popupbychat)throw"You need to start or join a Meet";var t=Moxtra._guid(),e={action:"message",message:e,message_id:t,delivery_mode:"broadcast"};return Moxtra._iframe?Moxtra._iframe.getElementsByTagName("iframe")[0].contentWindow.postMessage(JSON.stringify(e),Moxtra.baseUrl):Moxtra._popup?Moxtra._popup.postMessage(JSON.stringify(e),Moxtra.baseUrl):Moxtra._popupbychat&&Moxtra._popupbychat.postMessage(JSON.stringify(e),Moxtra.baseUrl),t},Moxtra.message.reply=function(e,t){if(!e||!t)throw"You must pass in options";if(!Moxtra._iframe&&!Moxtra._popup&&!Moxtra._popupbychat)throw"You need to start or join a Meet";var r=Moxtra._guid(),e={action:"message",message:t,message_id:r,reply_to:e,delivery_mode:"reply"};return Moxtra._iframe?Moxtra._iframe.getElementsByTagName("iframe")[0].contentWindow.postMessage(JSON.stringify(e),Moxtra.baseUrl):Moxtra._popup?Moxtra._popup.postMessage(JSON.stringify(e),Moxtra.baseUrl):Moxtra._popupbychat&&Moxtra._popupbychat.postMessage(JSON.stringify(e),Moxtra.baseUrl),r},Moxtra.clip=function(e){Moxtra.note(e)},Moxtra.note=function(i){var s,d,c,l,m,_;if(!i)throw"You must pass in options";Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first");var p=Moxtra_Session.get("note_refresh");if(p){if(!i.noterefresh_binder_id)return}else if(Moxtra._noteiframe)return;if(!Moxtra.clientId){if(i.error&&"function"==typeof i.error)return void i.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}Moxtra._timeMap.note=(new Date).getTime(),en=function(){var e,r,o,t,a,n=function(t){if(compareOrigin(t.origin))try{var e=JSON.parse(t.data);(i&&i.from_chat&&!0===i.from_chat?Moxtra._handleMessageFromChatEvent(e,i):Moxtra._handleMessageEvent(e,i))&&Moxtra.removeListener(window,"message",n)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}};Moxtra.addListener(window,"message",n),i.iframe&&!0===i.iframe?(_=Moxtra._createWidgetElement(Moxtra._SSOUrl(i,2),i,!1,!1),i.tagid4iframe?(r=function(){if(e=document.getElementById(i.tagid4iframe))!1===i.border?(e.appendChild(_),Moxtra._noteiframe=_):(s=Moxtra._createSimpleDivElement(i,_,"1024px","768px"),e.appendChild(s),Moxtra._noteiframe=s);else{if(p)return Moxtra_Session.remove("note_refresh"),void _.remove();!1===i.border?(document.body.appendChild(_),(Moxtra._noteiframe=_).scrollIntoView(!0)):(c=Moxtra._createDivElement(i,_,"1024px","768px"),document.body.appendChild(c),(Moxtra._noteiframe=c).scrollIntoView(!0))}},p?(o=0,function e(){o++;var t=setTimeout(e,1e3);!document.getElementById(i.tagid4iframe)&&6!==o||(clearTimeout(t),r())}()):r()):!1===i.border?(document.body.appendChild(_),(Moxtra._noteiframe=_).scrollIntoView(!0)):(c=Moxtra._createDivElement(i,_,"1024px","768px"),document.body.appendChild(c),(Moxtra._noteiframe=c).scrollIntoView(!0))):(m=1024,d=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-m)/2,m=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-768)/2,i.from_chat&&!0===i.from_chat?Moxtra.isIE()?(t=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",t+=encodeURIComponent(Moxtra._SSOUrl(i,2)+"&popup=1"),t+="&name=moxtranotebychat&others=",t+=encodeURIComponent("width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),a=Moxtra._createHiddenIframe(t),document.body.appendChild(a),Moxtra._notepopupbychat=a):(l=window.open(Moxtra._SSOUrl(i,2),"moxtranotebychat","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),Moxtra._notepopupbychat=l):Moxtra.isIE()?(t=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",t+=encodeURIComponent(Moxtra._SSOUrl(i,2)+"&popup=1"),t+="&name=moxtranote&others=",t+=encodeURIComponent("width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),a=Moxtra._createHiddenIframe(t),document.body.appendChild(a),Moxtra._notepopup=a):(l=window.open(Moxtra._SSOUrl(i,2),"moxtranote","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),Moxtra._notepopup=l),l&&l.focus())},en()},Moxtra.chat=function(a){var t,r,n,e,o,i;if(!a)throw"You must pass in options";if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),!Moxtra.clientId){if(a.error&&"function"==typeof a.error)return void a.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(o=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",o),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._chatiframe&&(document.body.removeChild(Moxtra._chatiframe),delete Moxtra._chatiframe),Moxtra._chatfunc&&(Moxtra.removeListener(window,"message",Moxtra._chatfunc),delete Moxtra._chatfunc))),Moxtra._timeMap.chat=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleChatMessageEvent(r,a,!0)&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe?(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._chatfunc=o,n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,3),a,!0,!1,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"850px","500px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._chatiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"850px","500px"),document.body.appendChild(r),Moxtra._chatiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-850)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-500)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,3)+"&popup=1"),e+="&name=moxtrachat&others=",e+=encodeURIComponent("width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,3),"moxtrachat","width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.timeline=function(a){var t,r,n,e,o,i;if(!a)throw"You must pass in options";if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),!Moxtra.clientId){if(a.error&&"function"==typeof a.error)return void a.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(o=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",o),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._timelineiframe&&(document.body.removeChild(Moxtra._timelineiframe),delete Moxtra._timelineiframe),Moxtra._timelinefunc&&(Moxtra.removeListener(window,"message",Moxtra._timelinefunc),delete Moxtra._timelinefunc))),Moxtra._timeMap.timeline=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleChatMessageEvent(r,a,!1)&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe&&(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._timelinefunc=o),a.iframe&&!0===a.iframe?(n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,5),a,!1,!1,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"1024px","768px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._timelineiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"1024px","768px"),document.body.appendChild(r),Moxtra._timelineiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-1024)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-768)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,5)+"&popup=1"),e+="&name=moxtratimeline&others=",e+=encodeURIComponent("width=1024,height=768,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,5),"moxtratimeline","width=1024,height=768,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.timelineData=function(o){if(!o)throw"You must pass in options";if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),Moxtra._timelineDatafunc&&(Moxtra.removeListener(window,"message",Moxtra._timelineDatafunc),delete Moxtra._timelineDatafunc),Moxtra._timelineDataiframe&&(document.body.removeChild(Moxtra._timelineDataiframe),delete Moxtra._timelineDataiframe),!Moxtra.clientId){if(o.error&&"function"==typeof o.error)return void o.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}ec=function(){var r=function(t){if(compareOrigin(t.origin)&&t.source==Moxtra._timelineDataiframe.contentWindow)try{var e=JSON.parse(t.data);Moxtra._handleDataMessageEvent(e,o,!1)&&(Moxtra.removeListener(window,"message",r),delete Moxtra._timelineDatafunc)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}};Moxtra.addListener(window,"message",r),Moxtra._timelineDatafunc=r;var e=Moxtra._createHiddenIframe(Moxtra._SSOUrl(o,13),!0);document.body.appendChild(e),Moxtra._timelineDataiframe=e},ec()},Moxtra.removeWidget=function(e){var t,r;e?(r=document.getElementById(e))&&Moxtra._hasChild(r)&&((t=Moxtra._viewMap[e])&&(r.removeChild(t),delete Moxtra._viewMap[e]),(t=Moxtra._handlerMap[e])&&(Moxtra.removeListener(window,"message",t),delete Moxtra._handlerMap[e])):(Moxtra._timelineiframe&&(document.body.removeChild(Moxtra._timelineiframe),delete Moxtra._timelineiframe),Moxtra._timelinefunc&&(Moxtra.removeListener(window,"message",Moxtra._timelinefunc),delete Moxtra._timelinefunc),Moxtra._chatiframe&&(document.body.removeChild(Moxtra._chatiframe),delete Moxtra._chatiframe),Moxtra._chatfunc&&(Moxtra.removeListener(window,"message",Moxtra._chatfunc),delete Moxtra._chatfunc),Moxtra._timelineViewiframe&&(document.body.removeChild(Moxtra._timelineViewiframe),delete Moxtra._timelineViewiframe),Moxtra._timelineViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._timelineViewfunc),delete Moxtra._timelineViewfunc),Moxtra._chatViewiframe&&(document.body.removeChild(Moxtra._chatViewiframe),delete Moxtra._chatViewiframe),Moxtra._chatViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._chatViewfunc),delete Moxtra._chatViewfunc),Moxtra._pageViewiframe&&(document.body.removeChild(Moxtra._pageViewiframe),delete Moxtra._pageViewiframe),Moxtra._pageViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._pageViewfunc),delete Moxtra._pageViewfunc),Moxtra._todoViewiframe&&(document.body.removeChild(Moxtra._todoViewiframe),delete Moxtra._todoViewiframe),Moxtra._todoViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._todoViewfunc),delete Moxtra._todoViewfunc),Moxtra._meetViewiframe&&(document.body.removeChild(Moxtra._meetViewiframe),delete Moxtra._meetViewiframe),Moxtra._meetViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._meetViewfunc),delete Moxtra._meetViewfunc),Moxtra._timelineDatafunc&&(Moxtra.removeListener(window,"message",Moxtra._timelineDatafunc),delete Moxtra._timelineDatafunc),Moxtra._timelineDataiframe&&(document.body.removeChild(Moxtra._timelineDataiframe),delete Moxtra._timelineDataiframe),Moxtra._annotefunc&&(Moxtra.removeListener(window,"message",Moxtra._annotefunc),delete Moxtra._annotefunc),Moxtra._annotateiframe&&(document.body.removeChild(Moxtra._annotateiframe),delete Moxtra._annotateiframe))},Moxtra.meet.prepare=function(o){if(!o)throw"You must pass in options";if(Moxtra._meetPreparefunc&&(Moxtra.removeListener(window,"message",Moxtra._meetPreparefunc),delete Moxtra._meetPreparefunc),Moxtra._meetPrepareiframe&&(document.body.removeChild(Moxtra._meetPrepareiframe),delete Moxtra._meetPrepareiframe),!Moxtra.clientId){if(o.error&&"function"==typeof o.error)return void o.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}ec=function(){var r=function(t){if(compareOrigin(t.origin)&&Moxtra._meetPrepareiframe&&t.source==Moxtra._meetPrepareiframe.contentWindow)try{var e=JSON.parse(t.data);Moxtra._handleDSMessageEvent(e,o,!1)&&(Moxtra.removeListener(window,"message",r),delete Moxtra._meetPreparefunc)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}};Moxtra.addListener(window,"message",r),Moxtra._meetPreparefunc=r;var e=Moxtra._createHiddenIframe(Moxtra._SSOUrl(o,15));document.body.appendChild(e),Moxtra._meetPrepareiframe=e},ec()},Moxtra.meet.screenshare=function(o){if(!o)throw"You must pass in options";var e,t;if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),!Moxtra.clientId){if(o.error&&"function"==typeof o.error)return void o.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}o.tagid4iframe&&((t=document.getElementById(o.tagid4iframe))&&Moxtra._hasChild(t)&&((e=Moxtra._viewMap[o.tagid4iframe])&&(t.removeChild(e),delete Moxtra._viewMap[o.tagid4iframe]),(e=Moxtra._handlerMap[o.tagid4iframe])&&(Moxtra.removeListener(window,"message",e),delete Moxtra._handlerMap[o.tagid4iframe])),delete Moxtra._meetScreenShareTag),t||(Moxtra._meetScreenShareiframe&&(document.body.removeChild(Moxtra._meetScreenShareiframe),delete Moxtra._meetScreenShareiframe),Moxtra._meetScreenSharefunc&&(Moxtra.removeListener(window,"message",Moxtra._meetScreenSharefunc),delete Moxtra._meetScreenSharefunc)),ec=function(){var r=function(t){if(compareOrigin(t.origin)&&o.handle_iframe&&o.handle_iframe.contentWindow==t.source)try{var e=JSON.parse(t.data);Moxtra._handleDSMessageEvent(e,o,!1)&&Moxtra.removeListener(window,"message",r)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}};Moxtra.addListener(window,"message",r),t?Moxtra._handlerMap[o.tagid4iframe]=r:Moxtra._meetScreenSharefunc=r;var e=Moxtra._createHiddenIframe(Moxtra._SSOUrl(o,16));t?("join"==o.action&&(e.style.height="100%"),t.appendChild(e),Moxtra._viewMap[o.tagid4iframe]=e,o.handle_iframe=e,Moxtra._meetScreenShareTag=o.tagid4iframe):("join"==o.action&&(e.style.width="1024px",e.style.height="768px"),document.body.appendChild(e),o.handle_iframe=e,Moxtra._meetScreenShareiframe=e)},ec()},Moxtra.meet.stopScreenshare=function(){var e,t;if(!Moxtra._meetScreenShareTag||(t=Moxtra._viewMap[Moxtra._meetScreenShareTag])&&(e=t.contentWindow),!(e=!e&&Moxtra._meetScreenShareiframe?Moxtra._meetScreenShareiframe.contentWindow:e))throw"Need an in-progress screenshare";e.postMessage('{"action":"request", "type":"stop_screen_share"}',Moxtra.baseUrl)},Moxtra.meet.endScreenshare=function(){var e=Moxtra._getEndDSURL(!0);if(e){if(Moxtra._meetScreenShareTag){var t=Moxtra._viewMap[Moxtra._meetScreenShareTag];if(t)return void(t.src=e)}Moxtra._meetScreenShareiframe&&(Moxtra._meetScreenShareiframe.src=e)}},Moxtra.meet.leaveScreenshare=function(){var e=Moxtra._getEndDSURL(!1);if(e){if(Moxtra._meetScreenShareTag){var t=Moxtra._viewMap[Moxtra._meetScreenShareTag];if(t)return void(t.src=e)}Moxtra._meetScreenShareiframe&&(Moxtra._meetScreenShareiframe.src=e)}},Moxtra._getEndDSURL=function(e,t){if(e){if(!Moxtra.ds_session_key)return void alert("Need to start a Moxtra Screen Share first!")}else if(!Moxtra.attds_session_key)return void alert("Need to join a Moxtra Screen Share first!");var r="websdk";t&&(r=t);var o=encodeURIComponent(window.location.protocol+"//"+window.location.host),t=Moxtra.baseUrl+Moxtra.version;return t=(t=e?t+"/#api.endMeet/"+Moxtra.ds_session_key+"?type="+r+"&session_id="+Moxtra.ds_session_id:t+"/#api.leaveMeet/"+Moxtra.attds_session_key+"?type="+r+"&session_id="+Moxtra.attds_session_id)+"&client_id="+Moxtra.clientId+"&origin="+o,Moxtra.appKey&&(t=Moxtra.ssoUrl+"?idpid="+Moxtra.appKey+"&target="+encodeURIComponent(t),Moxtra.partnerId?t+="&partnerid="+Moxtra.partnerId:Moxtra.orgId&&(t+="&orgid="+Moxtra.orgId)),t},Moxtra._hasChild=function(e){for(var t=0;e&&e.childNodes[t];t++)if(1===e.childNodes[t].nodeType||11===e.childNodes[t].nodeType)return!0;return!1},Moxtra.timelineView=function(a){var t,r,n,e,o,i;if(!a)throw"You must pass in options";if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),!Moxtra.clientId){if(a.error&&"function"==typeof a.error)return void a.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(o=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",o),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._timelineViewiframe&&(document.body.removeChild(Moxtra._timelineViewiframe),delete Moxtra._timelineViewiframe),Moxtra._timelineViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._timelineViewfunc),delete Moxtra._timelineViewfunc))),Moxtra._timeMap.timeline=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleViewMessageEvent(r,a,"timeline")&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe&&(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._timelineViewfunc=o),a.iframe&&!0===a.iframe?(n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,9),a,!1,!0,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"330px","768px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._timelineViewiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"330px","768px"),document.body.appendChild(r),Moxtra._timelineViewiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-330)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-768)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,9)+"&popup=1"),e+="&name=moxtratimelineView&others=",e+=encodeURIComponent("width=330,height=768,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,9),"moxtratimelineView","width=330,height=768,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.chatView=function(a){var t,r,n,e,o,i;if(!a)throw"You must pass in options";Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(o=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",o),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._chatViewiframe&&(document.body.removeChild(Moxtra._chatViewiframe),delete Moxtra._chatViewiframe),Moxtra._chatViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._chatViewfunc),delete Moxtra._chatViewfunc))),Moxtra._timeMap.chat=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleViewMessageEvent(r,a,"chat")&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe&&(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._chatViewfunc=o),a.iframe&&!0===a.iframe?(n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,10),a,!0,!0,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"850px","500px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._chatViewiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"850px","500px"),document.body.appendChild(r),Moxtra._chatViewiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-850)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-500)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,10)+"&popup=1"),e+="&name=moxtrachatView&others=",e+=encodeURIComponent("width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,10),"moxtrachatView","width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.pageView=function(a){var t,r,n;if(!a)throw"You must pass in options";var e,i,o=Moxtra_Session.get("init_refresh");if(o||console.warn("You must call Moxtra.init() first"),!a.binder_id&&!a.viewlink_url){if(a.error&&"function"==typeof a.error){var s={error_code:"invalid binder_id or viewlink_url",error_message:"You must set binder_id or viewlink_url"};return void a.error(s)}throw"You must set binder_id or viewlink_url"}if(!Moxtra.clientId){if(a.error&&"function"==typeof a.error){var s={error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"};return void a.error(s)}throw"Please set client_id in Moxtra.init()"}a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(s=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",s),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._pageViewiframe&&(document.body.removeChild(Moxtra._pageViewiframe),delete Moxtra._pageViewiframe),Moxtra._pageViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._pageViewfunc),delete Moxtra._pageViewfunc))),Moxtra._timeMap.page=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleViewMessageEvent(r,a,"page")&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe&&(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._pageViewfunc=o),a.iframe&&!0===a.iframe?(n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,11),a,!0,!0,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"850px","500px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._pageViewiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"850px","500px"),document.body.appendChild(r),Moxtra._pageViewiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-850)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-500)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,11)+"&popup=1"),e+="&name=moxtrapageView&others=",e+=encodeURIComponent("width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,11),"moxtrapageView","width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.todoView=function(a){var t,r,n,e,i;if(!a)throw"You must pass in options";if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),!a.binder_id){if(a.error&&"function"==typeof a.error){var o={error_code:"invalid binder_id",error_message:"You must set binder_id"};return void a.error(o)}throw"You must set binder_id"}if(!Moxtra.clientId){if(a.error&&"function"==typeof a.error){var o={error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"};return void a.error(o)}throw"Please set client_id in Moxtra.init()"}a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(o=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",o),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._todoViewiframe&&(document.body.removeChild(Moxtra._todoViewiframe),delete Moxtra._todoViewiframe),Moxtra._todoViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._todoViewfunc),delete Moxtra._todoViewfunc))),Moxtra._timeMap.todo=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleViewMessageEvent(r,a,"todo")&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe&&(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._todoViewfunc=o),a.iframe&&!0===a.iframe?(n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,12),a,!0,!0,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"850px","500px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._todoViewiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"850px","500px"),document.body.appendChild(r),Moxtra._todoViewiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-850)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-500)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,12)+"&popup=1"),e+="&name=moxtratodoView&others=",e+=encodeURIComponent("width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,12),"moxtratodoView","width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.meetView=function(a){var t,r,n,e,o,i;if(!a)throw"You must pass in options";Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(o=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",o),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._meetViewiframe&&(document.body.removeChild(Moxtra._meetViewiframe),delete Moxtra._meetViewiframe),Moxtra._meetViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._meetViewfunc),delete Moxtra._meetViewfunc))),Moxtra._timeMap.meetview=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleViewMessageEvent(r,a,"meet")&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe&&(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._meetViewfunc=o),a.iframe&&!0===a.iframe?(n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,14),a,!0,!0,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"850px","500px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._meetViewiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"850px","500px"),document.body.appendChild(r),Moxtra._meetViewiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-850)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-500)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,14)+"&popup=1"),e+="&name=moxtrameetView&others=",e+=encodeURIComponent("width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,10),"moxtrameetView","width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.auditView=function(a){var t,r,n,e,o,i;if(!a)throw"You must pass in options";if(!a.binder_id)throw"You must specify binder_id";if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),"/latest"!==Moxtra.version&&"/service5"!==Moxtra.version&&!Moxtra._isOnPremise)throw"Only sdk_version 5 or above support this feature";a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(o=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",o),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._auditViewiframe&&(document.body.removeChild(Moxtra._auditViewiframe),delete Moxtra._auditViewiframe),Moxtra._auditViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._auditViewfunc),delete Moxtra._auditViewfunc))),Moxtra._timeMap.auditview=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleAuditMessageEvent(r,a,"audit")&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe&&(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._auditViewfunc=o),a.iframe&&!0===a.iframe?(n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,17),a,!0,!0,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"850px","500px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._auditViewiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"850px","500px"),document.body.appendChild(r),Moxtra._auditViewiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-850)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-500)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,17)+"&popup=1"),e+="&name=moxtraAuditView&others=",e+=encodeURIComponent("width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,17),"moxtraAuditView","width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.transactionView=function(a){var t,r,n,e,o,i;if(!a)throw"You must pass in options";if(!a.binder_id)throw"You must specify binder_id";if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),"/latest"!==Moxtra.version&&"/service5"!==Moxtra.version&&!Moxtra._isOnPremise)throw"Only sdk_version 5 or above support this feature";a.iframe&&!0===a.iframe&&(a.tagid4iframe&&(i=document.getElementById(a.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[a.tagid4iframe])&&delete Moxtra._viewMap[a.tagid4iframe],(o=Moxtra._handlerMap[a.tagid4iframe])&&(Moxtra.removeListener(window,"message",o),delete Moxtra._handlerMap[a.tagid4iframe])),i||(Moxtra._transactionViewiframe&&(document.body.removeChild(Moxtra._transactionViewiframe),delete Moxtra._transactionViewiframe),Moxtra._transactionViewfunc&&(Moxtra.removeListener(window,"message",Moxtra._transactionViewfunc),delete Moxtra._transactionViewfunc))),Moxtra._timeMap.transactionview=(new Date).getTime(),ec=function(e){var o=function(t){if(compareOrigin(t.origin)){if(a.handle_iframe)if(!1===a.border){if(a.handle_iframe.contentWindow!=t.source)return}else{var e=a.handle_iframe.getElementsByTagName("iframe")[0]||a.handle_iframe;if(!e||e.contentWindow!=t.source)return}try{var r=JSON.parse(t.data);Moxtra._handleTransactionMessageEvent(r,a,"transaction")&&Moxtra.removeListener(window,"message",o)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}}};Moxtra.addListener(window,"message",o),a.iframe&&!0===a.iframe&&(i?Moxtra._handlerMap[a.tagid4iframe]=o:Moxtra._transactionViewfunc=o),a.iframe&&!0===a.iframe?(n=Moxtra._createWidgetElement(Moxtra._SSOUrl(a,19),a,!0,!0,e),a.tagid4iframe&&i&&(!1===a.border?e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[a.tagid4iframe]=n,a.handle_iframe=n):e?(Moxtra._viewMap[a.tagid4iframe]=e,a.handle_iframe=e):(t=Moxtra._createSimpleDivElement(a,n,"850px","500px"),i.appendChild(t),Moxtra._viewMap[a.tagid4iframe]=t,a.handle_iframe=t)),i||(!1===a.border?(document.body.appendChild(n),Moxtra._transactionViewiframe=n,(a.handle_iframe=n).scrollIntoView(!0)):(r=Moxtra._createDivElement(a,n,"850px","500px"),document.body.appendChild(r),Moxtra._transactionViewiframe=r,(a.handle_iframe=r).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-850)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-500)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(a,19)+"&popup=1"),e+="&name=moxtraTransactionView&others=",e+=encodeURIComponent("width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),a.handle_popup=e):(r=window.open(Moxtra._SSOUrl(a,19),"moxtraTransctionView","width=850,height=500,left="+n+",top="+r+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(a.handle_popup=r)&&r.focus()))},ec(e)},Moxtra.draw=function(e){Moxtra.annotate(e)},Moxtra.annotate=function(o){var t,a,n,e,r,i;if(!o)throw"You must pass in options";if(Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first"),!Moxtra.clientId){if(o.error&&"function"==typeof o.error)return void o.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}o.iframe&&!0===o.iframe&&(o.tagid4iframe&&(i=document.getElementById(o.tagid4iframe))&&Moxtra._hasChild(i)&&((e=Moxtra._viewMap[o.tagid4iframe])&&delete Moxtra._viewMap[o.tagid4iframe],(r=Moxtra._handlerMap[o.tagid4iframe])&&(Moxtra.removeListener(window,"message",r),delete Moxtra._handlerMap[o.tagid4iframe])),i||(Moxtra._annotateiframe&&(document.body.removeChild(Moxtra._annotateiframe),delete Moxtra._annotateiframe),Moxtra._annotefunc&&(Moxtra.removeListener(window,"message",Moxtra._annotefunc),delete Moxtra._annotefunc))),Moxtra._timeMap.annotate=(new Date).getTime(),an=function(e){var r=function(t){if(compareOrigin(t.origin))try{var e=JSON.parse(t.data);Moxtra._handleMessageEvent(e,o,!0)&&Moxtra.removeListener(window,"message",r)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}};Moxtra.addListener(window,"message",r),o.iframe&&!0===o.iframe?(i?Moxtra._handlerMap[o.tagid4iframe]=r:Moxtra._annotefunc=r,n=Moxtra._createWidgetElement(Moxtra._SSOUrl(o,6),o,!0,!1,e),o.tagid4iframe&&i&&(!1===o.border?e?(Moxtra._viewMap[o.tagid4iframe]=e,o.handle_iframe=e):(i.appendChild(n),Moxtra._viewMap[o.tagid4iframe]=n,o.handle_iframe=n):e?(Moxtra._viewMap[o.tagid4iframe]=e,o.handle_iframe=e):(t=Moxtra._createSimpleDivElement(o,n,"850px","500px"),i.appendChild(t),Moxtra._viewMap[o.tagid4iframe]=t,o.handle_iframe=t)),i||(!1===o.border?(document.body.appendChild(n),(Moxtra._annotateiframe=n).scrollIntoView(!0)):(a=Moxtra._createDivElement(o,n,"850px","500px"),document.body.appendChild(a),(Moxtra._annotateiframe=a).scrollIntoView(!0)))):(n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-850)/2,a=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-500)/2,Moxtra.isIE()?(e=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",e+=encodeURIComponent(Moxtra._SSOUrl(o,6)+"&popup=1"),e+="&name=moxtraannotate&others=",e+=encodeURIComponent("width=850,height=500,left="+n+",top="+a+",resizable=yes,location=0,titlebar=0,scrollbars=1"),e=Moxtra._createHiddenIframe(e),document.body.appendChild(e),o.handle_popup=e):(a=window.open(Moxtra._SSOUrl(o,6),"moxtraannotate","width=850,height=500,left="+n+",top="+a+",resizable=yes,location=0,titlebar=0,scrollbars=1"),(o.handle_popup=a)&&a.focus()))},an(e)},Moxtra.video=function(i){var s,d,c,l,m,_;if(!i)throw"You must pass in options";Moxtra_Session.get("init_refresh")||console.warn("You must call Moxtra.init() first");var p=Moxtra_Session.get("video_refresh");if(p){if(!i.videorefresh_session_key)return}else if(Moxtra._videoiframe)return;if(!Moxtra.clientId){if(i.error&&"function"==typeof i.error)return void i.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}Moxtra._timeMap.video=(new Date).getTime(),ef=function(){var e,r,o,t,a,n=function(t){if(compareOrigin(t.origin))try{var e=JSON.parse(t.data);(i&&i.from_chat&&!0===i.from_chat?Moxtra._handleMessageFromChatEvent(e,i):Moxtra._handleVideoMessageEvent(e,i))&&Moxtra.removeListener(window,"message",n)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}};Moxtra.addListener(window,"message",n),i.iframe&&!0===i.iframe?(_=Moxtra._createWidgetElement(Moxtra._SSOUrl(i,8),i,!1,!1),i.tagid4iframe?(r=function(){if(e=document.getElementById(i.tagid4iframe))!1===i.border?(e.appendChild(_),Moxtra._videoiframe=_):(s=Moxtra._createSimpleDivElement(i,_,"400px","300px"),e.appendChild(s),Moxtra._videoiframe=s);else{if(p)return Moxtra_Session.remove("video_refresh"),void _.remove();!1===i.border?(document.body.appendChild(_),(Moxtra._videoiframe=_).scrollIntoView(!0)):(c=Moxtra._createDivElement(i,_,"400px","300px"),document.body.appendChild(c),(Moxtra._videoiframe=c).scrollIntoView(!0))}},p?(o=0,function e(){o++;var t=setTimeout(e,1e3);!document.getElementById(i.tagid4iframe)&&6!==o||(clearTimeout(t),r())}()):r()):!1===i.border?(document.body.appendChild(_),(Moxtra._videoiframe=_).scrollIntoView(!0)):(c=Moxtra._createDivElement(i,_,"400px","300px"),document.body.appendChild(c),(Moxtra._videoiframe=c).scrollIntoView(!0))):(d=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-400)/2,m=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-300)/2,i.from_chat&&!0===i.from_chat?Moxtra.isIE()?(t=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",t+=encodeURIComponent(Moxtra._SSOUrl(i,8)+"&popup=1"),t+="&name=moxtravideobychat&others=",t+=encodeURIComponent("width=400,height=300,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),a=Moxtra._createHiddenIframe(t),document.body.appendChild(a),Moxtra._videopopupbychat=a):(l=i.tab&&!0===i.tab?window.open(Moxtra._SSOUrl(i,8),"moxtravideobychat","width=400,height=300,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0","_blank"):window.open(Moxtra._SSOUrl(i,8),"moxtravideobychat","width=400,height=300,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),Moxtra._videopopupbychat=l):Moxtra.isIE()?(t=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",t+=encodeURIComponent(Moxtra._SSOUrl(i,8)+"&popup=1"),t+="&name=moxtravideo&others=",t+=encodeURIComponent("width=400,height=300,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),a=Moxtra._createHiddenIframe(t),document.body.appendChild(a),Moxtra._videopopup=a):(l=i.tab&&!0===i.tab?window.open(Moxtra._SSOUrl(i,8),"moxtravideo","width=400,height=300,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0","_blank"):window.open(Moxtra._SSOUrl(i,8),"moxtravideo","width=400,height=300,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),Moxtra._videopopup=l),l&&l.focus())},ef()},Moxtra._getMeetURL=function(e,t,r,o){var a;if(r)a=r;else if(t){if(!Moxtra.session_key)return void alert("Need to start a Moxtra Meet first!");a=Moxtra.session_key}else{if(!Moxtra.video_session_key)return void alert("Need to start a Moxtra Video first!");a=Moxtra.video_session_key}r="websdk";o&&(r=o);o=encodeURIComponent(window.location.protocol+"//"+window.location.host),o=e?Moxtra.baseUrl+Moxtra.version+"/#api.endMeet/"+a+"?type="+r+"&client_id="+Moxtra.clientId+"&origin="+o:Moxtra.baseUrl+Moxtra.version+"/#api.leaveMeet/"+a+"?type="+r+"&client_id="+Moxtra.clientId+"&origin="+o;return t||(o+="&video=true"),t&&Moxtra.accessToken&&(Moxtra.autostart||!Moxtra.hideAccessTokenFromUrl)?o+="&access_token="+Moxtra.accessToken:t||!Moxtra.video_access_token||!Moxtra.autostart&&Moxtra.hideAccessTokenFromUrl?Moxtra.appKey&&(o=Moxtra.ssoUrl+"?idpid="+Moxtra.appKey+"&target="+encodeURIComponent(o),Moxtra.partnerId?o+="&partnerid="+Moxtra.partnerId:Moxtra.orgId&&(o+="&orgid="+Moxtra.orgId)):o+="&access_token="+Moxtra.video_access_token,Moxtra.hideAccessTokenFromUrl&&!Moxtra.autostart&&(o+="&security=true"),o},Moxtra.getJoinMeetURL=function(e,t,r,o){if(e)n=e;else{if(!Moxtra.session_key)return void alert("Need to start a Moxtra Meet first!");n=Moxtra.session_key}e="websdk";r&&(e=r);var a,r=encodeURIComponent(window.location.protocol+"//"+window.location.host),n=Moxtra.baseUrl+Moxtra.version+"/#join?session_key="+n+"&type="+e+"&client_id="+Moxtra.clientId+"&origin="+r;if(t&&(n+="&name=",n+=encodeURIComponent(t)),o&&o.extension)try{var i=JSON.stringify(o.extension),n=n+"&extension="+encodeURIComponent(i)}catch(e){console.warn(e.message)}if(o&&o.invisible&&(n+="&invisible="+o.invisible),o&&o.video&&(n+="&video=true"),o&&o.options)try{var s=JSON.stringify(o.options);n=n+"&options="+encodeURIComponent(s)}catch(e){console.warn(e.message)}return Moxtra._pluginversion&&(n=n+"&plugin_version="+Moxtra._pluginversion),Moxtra._theme&&(n=n+"&theme="+encodeURIComponent(Moxtra._theme)),o&&o.access_token&&(Moxtra.autostart||!Moxtra.hideAccessTokenFromUrl)?a=n+"&access_token="+o.access_token:!Moxtra.accessToken||!Moxtra.autostart&&Moxtra.hideAccessTokenFromUrl?Moxtra.appKey?Moxtra._barlogin?a=n:(a=Moxtra.ssoUrl+"?idpid="+Moxtra.appKey+"&target="+encodeURIComponent(n),Moxtra.partnerId?a+="&partnerid="+Moxtra.partnerId:Moxtra.orgId&&(a+="&orgid="+Moxtra.orgId)):a=o&&o.token?Moxtra.baseUrl+Moxtra.version+"/#login?token="+encodeURIComponent(o.token)+"&loginUrl="+encodeURIComponent(o.loginUrl)+"&type="+e+"&client_id="+Moxtra.clientId+"&origin="+r+"&backUrl="+encodeURIComponent(n):n:a=n+"&access_token="+Moxtra.accessToken,Moxtra.hideAccessTokenFromUrl&&!Moxtra.autostart&&(a+="&security=true"),a},Moxtra.auth_2fa_response=function(e){var t,r=Moxtra._auth2faMap[e];(r=r||Moxtra_Session.get("2fa_"+e))&&(r.handle_iframe?t=(!1!==r.border&&r.handle_iframe.getElementsByTagName("iframe")[0]||r.handle_iframe).contentWindow:r.handle_popup&&(t=r.handle_popup.contentWindow),t&&t.postMessage('{"action":"auth_2fa_response", "request_id":"'+e+'"}',Moxtra.baseUrl),Moxtra_Session.remove("2fa_"+e),delete Moxtra._auth2faMap[e])},Moxtra.binderChooser=function(a){bc=function(){var t=function(e){e.source==Moxtra._window&&(e=JSON.parse(e.data),Moxtra._selected(e,a),Moxtra.removeListener(window,"message",t))};Moxtra.addListener(window,"message",t);var e,r,o="websdk";a&&a.type&&(o=a.type),Moxtra.appKey?(r=Moxtra.ssoUrl+"?idpid="+Moxtra.appKey+"&target="+encodeURIComponent(Moxtra.baseUrl+Moxtra.version+"/#chooser?client_id="+Moxtra.clientId+"&type="+o),Moxtra.partnerId?r+="&partnerid="+Moxtra.partnerId:Moxtra.orgId&&(r+="&orgid="+Moxtra.orgId)):r=a&&a.token?(e=encodeURIComponent(window.location.protocol+"//"+window.location.host),Moxtra.baseUrl+Moxtra.version+"/#login?token="+encodeURIComponent(a.token)+"&loginUrl="+encodeURIComponent(a.loginUrl)+"&type="+o+"&client_id="+Moxtra.clientId+"&origin="+e+"&backUrl="+encodeURIComponent(Moxtra.baseUrl+Moxtra.version+"/#chooser?client_id="+Moxtra.clientId+"&type="+o)):Moxtra.baseUrl+Moxtra.version+"/#chooser?client_id="+Moxtra.clientId+"&type="+o,e=a&&a.width?a.width:"886",o=a&&a.height?a.height:"560",Moxtra._window=window.open(r,"chooser","location=0,scrollbars=1,status=0,titlebar=0,toolbar=0,menubar=0,width="+e+",height="+o),Moxtra._window.focus()},bc()},Moxtra.pageChooser=function(a){pc=function(){var t=function(e){e.source==Moxtra._pageWindow&&(e=JSON.parse(e.data),Moxtra._pageSelected(e,a),Moxtra.removeListener(window,"message",t))};Moxtra.addListener(window,"message",t);var e,r,o="websdk";a&&a.type&&(o=a.type),Moxtra.appKey?(r=Moxtra.ssoUrl+"?idpid="+Moxtra.appKey+"&target="+encodeURIComponent(Moxtra.baseUrl+"/api/html/pageselector.htm?client_id="+Moxtra.clientId),Moxtra.partnerId?r+="&partnerid="+Moxtra.partnerId:Moxtra.orgId&&(r+="&orgid="+Moxtra.orgId)):r=a&&a.token?(e=encodeURIComponent(window.location.protocol+"//"+window.location.host),Moxtra.baseUrl+Moxtra.version+"/#login?token="+encodeURIComponent(a.token)+"&loginUrl="+encodeURIComponent(a.loginUrl)+"&type="+o+"&client_id="+Moxtra.clientId+"&origin="+e+"&backUrl="+encodeURIComponent(Moxtra.baseUrl+"/api/html/pageselector.htm?client_id="+Moxtra.clientId)):Moxtra.baseUrl+"/api/html/pageselector.htm?client_id="+Moxtra.clientId,Moxtra._pageWindow=window.open(r,"pageChooser","location=0,scrollbars=1,status=0,titlebar=0,toolbar=0,menubar=0,width=886,height=560"),Moxtra._pageWindow.focus()},pc()},Moxtra.toolbar_startmeet=function(){return Moxtra.meet({success:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetSuccess",!1,!1),t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,Moxtra._toolbar.dispatchEvent(t))},error:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetError",!1,!1),t.error_code=e.error_code,t.error_message=e.error_message,Moxtra._toolbar.dispatchEvent(t))},exit:function(){var e;document.createEvent&&((e=document.createEvent("Event")).initEvent("MeetExit",!1,!1),Moxtra._toolbar.dispatchEvent(e))},invite:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetInvite",!1,!1),t.binder_id=e.binder_id,t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,Moxtra._toolbar.dispatchEvent(t))},invited:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MemberInvited",!1,!1),t.binder_id=e.binder_id,t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,Moxtra._toolbar.dispatchEvent(t))},save:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetSaved",!1,!1),t.binder_id=e.binder_id,t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,Moxtra._toolbar.dispatchEvent(t))},iframe:!1,_trigger:"button"}),!1},Moxtra.toolbar_startnote=function(){return Moxtra.note({start_note:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("NoteStart",!1,!1),t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,Moxtra._toolbar.dispatchEvent(t))},error:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("NoteError",!1,!1),t.error_code=e.error_code,t.error_message=e.error_message,Moxtra._toolbar.dispatchEvent(t))},save_note:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("NoteSave",!1,!1),t.destination_binder_id=e.destination_binder_id,t.download_url=e.download_url,t.share_url=e.share_url,Moxtra._toolbar.dispatchEvent(t))},cancel:function(){var e;document.createEvent&&((e=document.createEvent("Event")).initEvent("NoteCancel",!1,!1),Moxtra._toolbar.dispatchEvent(e))},iframe:!1,_trigger:"button"}),!1},Moxtra.toolbar_startchat=function(){return Moxtra.chat({start_chat:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("ChatStart",!1,!1),t.binder_id=e.binder_id,t.session_id=e.session_id,Moxtra._toolbar.dispatchEvent(t))},request_meet:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetRequest",!1,!1),t.binder_id=e.binder_id,Moxtra._toolbar.dispatchEvent(t))},request_note:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("NoteRequest",!1,!1),Moxtra._toolbar.dispatchEvent(t))},error:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("ChatError",!1,!1),t.error_code=e.error_code,t.error_message=e.error_message,Moxtra._toolbar.dispatchEvent(t))},iframe:!1,_trigger:"button"}),!1},Moxtra._selected=function(e,t){t&&"function"==typeof t.select?t.select(e):Moxtra._chooser&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("BinderSelect",!1,!1),m.binder_name=e.binder_name,m.binder_id=e.binder_id,m.binder_imageUrl=e.binder_imageUrl,m.binder_viewUrl=e.binder_viewUrl,Moxtra._chooser.dispatchEvent(m)),Moxtra._window.close()},Moxtra._pageSelected=function(e,t){t&&"function"==typeof t.select?t.select(e):Moxtra._pageChooser&&document.createEvent&&(m=document.createEvent("Event"),m.initEvent("PagesSelect",!1,!1),m.binder_name=e.binder_name,m.binder_id=e.binder_id,m.binder_imageUrl=e.binder_imageUrl,m.binder_viewUrl=e.binder_viewUrl,m.page_url_prefix=e.page_url_prefix,m.page_viewUrl_prefix=e.page_viewUrl_prefix,m.pages=e.pages,Moxtra._pageChooser.dispatchEvent(m)),Moxtra._pageWindow.close()},Moxtra.setValue=function(e,t){var r;null!=e&&void 0!==e&&1==e.nodeType&&("div"==(r=e.tagName.toLowerCase())?e.innerHTML=t:"input"==r?e.value=t:"img"==r&&(img.src=t))},Moxtra.startCB=function(i){var s,d,c,l,m,_;if(!i)throw"You must pass in options";var e=Moxtra_Session.get("init_refresh");Moxtra.checkRefreshInterval&&clearInterval(Moxtra.checkRefreshInterval),e||console.warn("You must call Moxtra.init() first");var p=Moxtra_Session.get("meet_refresh");if(p){if(!i.refresh_binder_id)return}else if(Moxtra._iframe)return;if(i.joinURL&&(Moxtra.joinURL=i.joinURL),i.appKey&&(Moxtra.appKey=i.appKey),i.partnerId&&(Moxtra.partnerId=i.partnerId),i.orgId&&(Moxtra.orgId=i.orgId),i.clientId&&(Moxtra.clientId=i.clientId),!Moxtra.clientId){if(i.error&&"function"==typeof i.error)return void i.error({error_code:"invalid client_id",error_message:"Please set client_id in Moxtra.init()"});throw"Please set client_id in Moxtra.init()"}Moxtra._timeMap.meet=(new Date).getTime(),ef=function(){var e,r,o,t,a,n=function(t){if(compareOrigin(t.origin))try{var e=JSON.parse(t.data);Moxtra._handleMessageEvent(e,i)&&Moxtra.removeListener(window,"message",n)}catch(e){console.warn("JSON parse error: "+e.message+" for "+t.data)}};Moxtra.addListener(window,"message",n),i.iframe&&!0===i.iframe?(_=Moxtra._createWidgetElement(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,18),i,!1,!1),i.tagid4iframe?(r=function(){if(e=document.getElementById(i.tagid4iframe))!1===i.border?(e.appendChild(_),Moxtra._iframe=_):(s=Moxtra._createSimpleDivElement(i,_,"1024px","768px"),e.appendChild(s),Moxtra._iframe=s);else{if(p)return Moxtra_Session.remove("meet_refresh"),void _.remove();!1===i.border?(document.body.appendChild(_),(Moxtra._iframe=_).scrollIntoView(!0)):(c=Moxtra._createDivElement(i,_,"1024px","768px"),document.body.appendChild(c),(Moxtra._iframe=c).scrollIntoView(!0))}},p?(o=0,function e(){o++;var t=setTimeout(e,1e3);!document.getElementById(i.tagid4iframe)&&6!==o||(clearTimeout(t),r())}()):r()):!1===i.border?(document.body.appendChild(_),(Moxtra._iframe=_).scrollIntoView(!0)):(c=Moxtra._createDivElement(i,_,"1024px","768px"),document.body.appendChild(c),(Moxtra._iframe=c).scrollIntoView(!0))):(m=1024,d=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-m)/2,m=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-768)/2,!0===i.from_chat?Moxtra.isIE()?(t=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",t+=encodeURIComponent(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1)+"&popup=1"),t+="&name=moxtrabychat&others=",t+=encodeURIComponent("width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),a=Moxtra._createHiddenIframe(t),document.body.appendChild(a),Moxtra._popupbychat=a):(l=!0===i.tab?window.open(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1),"moxtrabychat","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0","_blank"):window.open(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1),"moxtrabychat","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),Moxtra._popupbychat=l):Moxtra.isIE()?(t=Moxtra.baseUrl+"/api/html/iframeforpopup.htm?url=",t+=encodeURIComponent(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,1)+"&popup=1"),t+="&name=moxtra&others=",t+=encodeURIComponent("width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),a=Moxtra._createHiddenIframe(t),document.body.appendChild(a),Moxtra._popup=a):(l=!0===i.tab?window.open(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,18),"moxtra","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0","_blank"):window.open(i.joinURL?Moxtra._JOINUrl(i):Moxtra._SSOUrl(i,18),"moxtra","width=1024,height=768,left="+d+",top="+m+",resizable=yes,location=0,titlebar=0"),Moxtra._popup=l),l&&l.focus())},ef()},m_a=function(){for(var t,a,i,s,d,e=Moxtra_Session.get("init_refresh"),c=Moxtra_Session.get("meet_refresh"),l=Moxtra_Session.get("note_refresh"),r=Moxtra_Session.get("video_refresh"),o=document.getElementsByTagName("input"),n=function(r){var o,e,n;"moxtra-meet"!==r.getAttribute("type")&&"moxtra-meet-iframe"!==r.getAttribute("type")||((o=document.createElement("div")).className="moxtra-meet",r.style.display="none",Moxtra._meet=r,a="moxtra-meet-iframe"===r.getAttribute("type")?o:null,Moxtra.addListener(o,"click",function(e){t="moxtra-meet-iframe"===r.getAttribute("type"),c=Moxtra_Session.get("meet_refresh"),Moxtra.meet(c||{success:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetSuccess",!1,!1),t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,r.dispatchEvent(t)),o.className="moxtra-meet moxtra-meet-used"},error:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetError",!1,!1),t.error_code=e.error_code,t.error_message=e.error_message,r.dispatchEvent(t))},exit:function(){var e;document.createEvent&&((e=document.createEvent("Event")).initEvent("MeetExit",!1,!1),r.dispatchEvent(e))},invite:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetInvite",!1,!1),t.binder_id=e.binder_id,t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,r.dispatchEvent(t))},invited:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MemberInvited",!1,!1),t.binder_id=e.binder_id,t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,r.dispatchEvent(t))},save:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetSaved",!1,!1),t.binder_id=e.binder_id,t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,r.dispatchEvent(t))},iframe:t,extension:{show_dialogs:{meet_invite:!0}},_trigger:"button"})}),r.parentNode.insertBefore(o,r)),"moxtra-note"!==r.getAttribute("type")&&"moxtra-note-iframe"!==r.getAttribute("type")||(nt=document.createElement("div"),nt.className="moxtra-note",r.style.display="none",Moxtra._note=r,s="moxtra-note-iframe"===r.getAttribute("type")?o:null,Moxtra.addListener(nt,"click",function(e){i="moxtra-note-iframe"===r.getAttribute("type"),l=Moxtra_Session.get("note_refresh"),Moxtra.note(l||{start_note:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("NoteStart",!1,!1),t.session_key=e.session_key,t.meet_id=e.meet_id,t.session_id=e.session_id,r.dispatchEvent(t)),nt.className="moxtra-note moxtra-note-used"},error:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("NoteError",!1,!1),t.error_code=e.error_code,t.error_message=e.error_message,r.dispatchEvent(t))},save_note:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("NoteSave",!1,!1),t.destination_binder_id=e.destination_binder_id,t.download_url=e.download_url,t.share_url=e.share_url,r.dispatchEvent(t))},cancel:function(){var e;document.createEvent&&((e=document.createEvent("Event")).initEvent("NoteCancel",!1,!1),r.dispatchEvent(e))},iframe:i,_trigger:"button"})}),r.parentNode.insertBefore(nt,r)),"moxtra-chat"!==r.getAttribute("type")&&"moxtra-chat-iframe"!==r.getAttribute("type")||(nt=document.createElement("div"),nt.className="moxtra-chat",r.style.display="none",Moxtra._chat=r,r.getAttribute("type"),Moxtra.addListener(nt,"click",function(e){d="moxtra-chat-iframe"===r.getAttribute("type"),Moxtra.chat({start_chat:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("ChatStart",!1,!1),t.binder_id=e.binder_id,t.session_id=e.session_id,r.dispatchEvent(t)),nt.className="moxtra-chat moxtra-chat-used"},request_meet:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("MeetRequest",!1,!1),t.binder_id=e.binder_id,r.dispatchEvent(t))},request_note:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("NoteRequest",!1,!1),r.dispatchEvent(t))},error:function(e){var t;document.createEvent&&((t=document.createEvent("Event")).initEvent("ChatError",!1,!1),t.error_code=e.error_code,t.error_message=e.error_message,r.dispatchEvent(t))},iframe:d,_trigger:"button"})}),r.parentNode.insertBefore(nt,r)),"moxtra-chooser"===r.getAttribute("type")?(e=document.createElement("div"),Moxtra._chooser=r,e.className="moxtra-chooser",r.style.display="none",Moxtra.addListener(e,"click",function(e){Moxtra.binderChooser()}),r.parentNode.insertBefore(e,r)):"moxtra-pagechooser"===r.getAttribute("type")&&(e=document.createElement("div"),Moxtra._pageChooser=r,e.className="moxtra-pagechooser",r.style.display="none",Moxtra.addListener(e,"click",function(e){Moxtra.pageChooser()}),r.parentNode.insertBefore(e,r)),"moxtra-timeline"===r.getAttribute("type")&&(Moxtra._timeline=r,n={c:0,i:0,o:0,s:0,m:0,q:0,d:Moxtra.baseUrl,n:5,g:60,w:760,h:500,r:0,init:function(e,t){var r,o,a=document;a.all&&"complete"!=a.readyState||!a.body?setTimeout(function(){n.init(e,t)},100):((r=window).addEventListener?r.addEventListener("keyup",n.esc_close):r.attachEvent("keyup",n.esc_close),n.c=a.createElement("DIV"),r=n.c,o="CSS1Compat"!=a.compatMode,o=/MSIE 6/i.test(navigator.userAgent)||/MSIE/i.test(navigator.userAgent)&&o?"absolute":"fixed",r.style.position=o,r.style.bottom="5px",r.style.right="5px",r.style.zIndex=2147483647,r.style.lineHeight="12px",e='<div style="position: absolute; bottom: '+n.g+'px; right: 0px; visibility: hidden; overflow: hidden; padding: 0px; height: 0;"><img src="'+n.d+'/api/images/logo-icon.png" style="cursor:pointer;position:absolute;top:0;left:0;border-style:solid;border-color: #00a2e8;border-radius: 5px;" onclick="window[ \'_mchat\' ].toggle(true);" /><div style="width:'+n.w+"px;height:"+n.h+'px;">'+e+'</div></div><div style="position: absolute; bottom: 0px; right: 0px; width: 45 px; height: 45 px; padding: 3px; cursor: pointer;" title="Click to toggle timeline" onmouseover="window[ \'_mchat\' ].stop();" onclick="window[ \'_mchat\' ].toggle();"><img src="'+n.d+'/api/images/logo.png" alt="Click to toggle timeline" style="max-width: none;border-style:solid;border-color: #00a2e8;border-radius: 5px;border-width: 1px;padding: 3px;width: 40px;height: 40px;"/>',t&&(e+='<div style="position: absolute; bottom: 32px; right: 3px; font: bold 14px arial; text-align:center;"><img src="'+n.d+'/api/images/mini_wait.gif"/></div>'),r.innerHTML=e+"</div>",a.body.appendChild(r),n.r=setInterval(n.query,5e3),n.start())},start:function(){n.q||n.n--<=0||(n.s=5,n.m=30,n.i=setInterval(n.move,30))},stop:function(){n.q=1,n.c.style.bottom="5px",clearInterval(n.i)},move:function(){var e=n.c,t=parseInt(e.style.bottom)+n.s;t>=n.m?(t=n.m,n.s*=-1,n.s-=Math.abs(n.s)%2):t<=5&&(n.s=Math.abs(n.s)-1,(n.m-=4)<=0&&(clearInterval(n.i),setTimeout(n.start,2e3)),t=5),e.style.bottom=t+"px"},toggle:function(e){clearInterval(n.o);var t=n.c.childNodes[0],r=-100;"hidden"==t.style.visibility&&1!=e&&(r*=-1,t.style.width="0px",t.style.height="0px",t.style.visibility="visible"),n.o=setInterval(function(){n.show(t,r)},1)},show:function(e,t){var r=e.offsetWidth+t,o=e.offsetHeight+t,t=0;0<=o||(o=0),0<=(r=!(0<=r)?0:r)&&0<=o&&(r<=n.w?t=1:r=n.w,o<=n.h?t=1:o=n.h,e.style.width=r+"px",e.style.height=o+"px"),(!t||r<=0||o<=0)&&(clearInterval(n.o),r<n.w?(e.style.visibility="hidden",e.style.padding="0"):e.style.padding="8px"),"hidden"==e.style.visibility&&(n.r=setInterval(n.query,1e3))},query:function(){try{jQuery.ajax({url:Moxtra.baseUrl+"/oauthapi/unreadfeed",dataType:"jsonp",success:function(e){e&&"ok"==e.status&&(clearInterval(n.r),n.r=setInterval(n.query,18e4)),e&&e.count?n.c.lastChild.lastChild.innerHTML='<font color="white" style="background-color:red;border-radius: 100%;">'+e.count+"</font>":n.c.lastChild.lastChild.innerHTML=""},error:function(e){clearInterval(n.r),n.c.lastChild.lastChild.innerHTML="",n.r=setInterval(n.query,1e4)}})}catch(e){}},esc_close:function(e){27==(e.keyCode||e.which)&&n.toggle(!0)}},(window._mchat=n).init('<iframe id="_mchatf" src="'+Moxtra._SSOUrl(null,4)+'" frameborder="0" allowtransparency="true" allowfullscreen="true" style="width: 100%; height: 100%; overflow: scroll; background-color: transparent;"></iframe>',1)),"moxtra-toolbar"===r.getAttribute("type")&&(Moxtra._toolbar=r,n={c:0,i:0,o:0,s:0,m:0,q:0,d:Moxtra.baseUrl,n:5,g:60,w:760,h:500,r:0,init:function(e,t){var r,o=document;o.all&&"complete"!=o.readyState||!o.body?setTimeout(function(){n.init(e,t)},100):((r=window).addEventListener?r.addEventListener("keyup",n.esc_close):r.attachEvent("keyup",n.esc_close),n.c=o.createElement("DIV"),(r=n.c).style.zIndex=2147483647,r.style.lineHeight="12px",e='<div style="position: absolute; bottom: '+n.g+'px; right: 0px; visibility: hidden; overflow: hidden; padding: 0px; height: 0;"><img src="'+n.d+'/api/images/logo-icon.png" style="cursor:pointer;position:absolute;top:0;left:0;border-style:solid;border-color: #00a2e8;border-radius: 5px;" onclick="window[ \'_mtool\' ].toggle(true);" /><div style="width:'+n.w+"px;height:"+n.h+'px;">'+e+'</div></div><div style="position: absolute; bottom: 0px; right: 0px; height: 60px; cursor: pointer; overflow:hidden; padding: 5px; background: #eee;"><div title="Start Meet" style="float:left; width: 45 px; height: 45 px; padding: 3px;" onmouseover="" onclick="return Moxtra.toolbar_startmeet();"><img src="'+n.d+'/api/images/meet.png" alt="Click to start Meet" style="max-width: none;border-style:solid;border-color: #00a2e8;border-radius: 5px;border-width: 1px;padding: 3px;width: 40px;height: 40px;"/></div><div title="Create Note" style="float:left; width: 45 px; height: 45 px; padding: 3px;" onmouseover="" onclick="return Moxtra.toolbar_startnote();"><img src="'+n.d+'/api/images/note.png" alt="Click to create Note"  style="max-width: none;border-style:solid;border-color: #00a2e8;border-radius: 5px;border-width: 1px;padding: 3px;width: 40px;height: 40px;"/></div><div title="Chat Now" style="float:left; width: 45 px; height: 45 px;padding:3px;" onmouseover="" onclick="return Moxtra.toolbar_startchat();"><img src="'+n.d+'/api/images/chat.png" alt="Click to join the conversation" style="max-width: none;border-style:solid;border-color: #00a2e8;border-radius: 5px;border-width: 1px;padding: 3px;width: 40px;height: 40px;"/></div><div title="Click to toggle timeline" style="float:left; width: 45 px; height: 45 px;padding:3px;" onmouseover="window[ \'_mtool\' ].stop();" onclick="window[ \'_mtool\' ].toggle();"><img src="'+n.d+'/api/images/logo.png" alt="Click to toggle timeline" style="max-width: none;border-style:solid;border-color: #00a2e8;border-radius: 5px;border-width: 1px;padding: 3px;width: 40px;height: 40px;"/>',t&&(e+='<div style="position: absolute; bottom: 45px; right: 3px; font: bold 14px arial; text-align:center;"><img src="'+n.d+'/api/images/mini_wait.gif"/></div>'),r.innerHTML=e+"</div></div>",o.body.appendChild(r),n.r=setInterval(n.query,5e3))},start:function(){},stop:function(){n.q=1,n.c.style.bottom="5px",clearInterval(n.i)},toggle:function(e){clearInterval(n.o);var t=n.c.childNodes[0],r=-100;"hidden"==t.style.visibility&&1!=e&&(r*=-1,t.style.width="0px",t.style.height="0px",t.style.visibility="visible"),n.o=setInterval(function(){n.show(t,r)},1)},show:function(e,t){var r=e.offsetWidth+t,o=e.offsetHeight+t,t=0;0<=o||(o=0),0<=(r=!(0<=r)?0:r)&&0<=o&&(r<=n.w?t=1:r=n.w,o<=n.h?t=1:o=n.h,e.style.width=r+"px",e.style.height=o+"px"),(!t||r<=0||o<=0)&&(clearInterval(n.o),r<n.w?(e.style.visibility="hidden",e.style.padding="0"):e.style.padding="8px"),"hidden"==e.style.visibility&&(n.r=setInterval(n.query,2e3))},query:function(){try{jQuery.ajax({url:Moxtra.baseUrl+"/oauthapi/unreadfeed",dataType:"jsonp",success:function(e){e&&"ok"==e.status?(clearInterval(n.r),n.r=setInterval(n.query,18e4),Moxtra._barlogin=!0):Moxtra._barlogin=!1,e&&e.count?n.c.lastChild.lastChild.lastChild.innerHTML='<font color="white" style="background-color:red;border-radius: 100%;">'+e.count+"</font>":n.c.lastChild.lastChild.lastChild.innerHTML=""},error:function(e){clearInterval(n.r),n.c.lastChild.lastChild.lastChild.innerHTML="",n.r=setInterval(n.query,1e4),Moxtra._barlogin=!1}})}catch(e){}},esc_close:function(e){27==(e.keyCode||e.which)&&n.toggle(!0)}},(window._mtool=n).init('<iframe id="_mtoolf" src="'+Moxtra._SSOUrl(null,4)+'" frameborder="0" allowtransparency="true" allowfullscreen="true" style="width: 100%; height: 100%; overflow: scroll; background-color: transparent;"></iframe>',1))},m=0,_=o.length;m<_;m++)n(o[m]);c&&(a?eventFire(a,"click"):(e&&Moxtra.init(e),Moxtra.meet(c))),l&&(s?eventFire(s,"click"):(e&&Moxtra.init(e),Moxtra.note(l))),r&&(e&&Moxtra.init(e),Moxtra.video(r))},function(){var e=document.getElementById("moxtrajs");Moxtra.appKey||(Moxtra.appKey=e?e.getAttribute("data-app-key"):void 0),Moxtra.partnerId||(Moxtra.partnerId=e?e.getAttribute("data-partner-id"):void 0),Moxtra.orgId||(Moxtra.orgId=e?e.getAttribute("data-org-id"):void 0),Moxtra.clientId||(Moxtra.clientId=e?e.getAttribute("data-client-id"):void 0),e&&0<=e.getAttribute("src").indexOf("../js")&&(Moxtra.baseUrl="https://"+window.location.host),"idpdemo"==Moxtra.appKey?Moxtra.ssoUrl=Moxtra.baseUrl+"/sp/spdemo":Moxtra.ssoUrl=Moxtra.baseUrl+"/sp/startSSO",Moxtra.checkRefreshInterval=setInterval(function(){/in/.test(document.readyState)||(clearInterval(Moxtra.checkRefreshInterval),m_a())},9)}();